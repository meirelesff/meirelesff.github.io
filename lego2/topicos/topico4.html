<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lego II - Experimentos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="Lego II - Experimentos">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="topico4_files/figure-html/unnamed-chunk-18-1.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Lego II</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Procurar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Alternar de navegação" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../template.html" rel="" target="">
 <span class="menu-text">Template</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tópicos" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Tópicos</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tópicos">    
        <li>
    <a class="dropdown-item" href="../topicos/topico1.html" rel="" target="">
 <span class="dropdown-text">Simulações</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../topicos/topico2.html" rel="" target="">
 <span class="dropdown-text">Regressão linear simples</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../topicos/topico3.html" rel="" target="">
 <span class="dropdown-text">Regressão linear múltipla</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../topicos/topico4.html" rel="" target="">
 <span class="dropdown-text">Experimentos</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-replicações" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Replicações</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-replicações">    
        <li>
    <a class="dropdown-item" href="../replicacao/replicacao1.html" rel="" target="">
 <span class="dropdown-text">Replicação I</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="http://www.github.com/meirelesff" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Nesta página</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução">Introdução</a></li>
  <li><a href="#estimador-de-diferença-de-médias" id="toc-estimador-de-diferença-de-médias" class="nav-link" data-scroll-target="#estimador-de-diferença-de-médias">Estimador de diferença de médias</a>
  <ul class="collapse">
  <li><a href="#teste-de-diferença-de-médias" id="toc-teste-de-diferença-de-médias" class="nav-link" data-scroll-target="#teste-de-diferença-de-médias">Teste de diferença de médias</a></li>
  </ul></li>
  <li><a href="#estimador-de-regressão-linear" id="toc-estimador-de-regressão-linear" class="nav-link" data-scroll-target="#estimador-de-regressão-linear">Estimador de regressão linear</a>
  <ul class="collapse">
  <li><a href="#estimativa-com-dados-observacionais" id="toc-estimativa-com-dados-observacionais" class="nav-link" data-scroll-target="#estimativa-com-dados-observacionais">Estimativa com dados observacionais</a></li>
  </ul></li>
  <li><a href="#estimatr" id="toc-estimatr" class="nav-link" data-scroll-target="#estimatr"><code>estimatr</code></a></li>
  <li><a href="#efeito-marginal-do-componente-amce" id="toc-efeito-marginal-do-componente-amce" class="nav-link" data-scroll-target="#efeito-marginal-do-componente-amce">Efeito marginal do componente (AMCE)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Experimentos</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introdução" class="level2">
<h2 class="anchored" data-anchor-id="introdução">Introdução</h2>
<p>Estas notas introduzem análise de experimentos em <code>R</code>, o que cobrirá como usar dois estimadores comuns para analisar este tipo de desenho: estimador de diferença de médias e regressão linear por MQO.</p>
<p>Usaremos como exemplo os dados de <span class="citation" data-cites="lalonde1986evaluating">LaLonde (<a href="#ref-lalonde1986evaluating" role="doc-biblioref">1986</a>)</span>, usados em seu <em>paper</em> clássico comparando os resultados de um <em>randomized controlled trial</em> (i.e., um experimento de campo) de treinamento profissional para homens desempregados sobre suas rendas futuras com os resultados de um estudo observacional. Trata-se de um estudo clássico na Economia, e nas Ciências Sociais, de forma geral, por ser um dos primeiros a mostrar que os resultados de um experimento podem ser muito diferentes dos resultados de um estudo observacional, utilizando modelos de regressão saturados.</p>
<p>Antes de avançar, precisaremos carregar as duas bases, a <a href="../docs/data/nsw_exp.dta">com dados experimentais</a> e a <a href="../docs/data/nsw_obs.dta">com dados observacionais</a>. Para isso, usaremos o pacote <code>haven</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>nsw_exp <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"nsw_exp.dta"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>nsw_obs <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"nsw_obs.dta"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As variáveis que temos nas duas bases são:</p>
<table class="table-striped table-hover table-sm small table">
<caption>Variáveis nas bases de dados de <span class="citation" data-cites="lalonde1986evaluating">LaLonde (<a href="#ref-lalonde1986evaluating" role="doc-biblioref">1986</a>)</span></caption>
<colgroup>
<col style="width: 12%">
<col style="width: 87%">
</colgroup>
<thead>
<tr class="header">
<th>Nome</th>
<th>Variável</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>nsw</td>
<td>Dummy para participantes do NSW</td>
</tr>
<tr class="even">
<td>age</td>
<td>Idade (em anos)</td>
</tr>
<tr class="odd">
<td>educ</td>
<td>Anos de escolaridade</td>
</tr>
<tr class="even">
<td>black</td>
<td>Dummy para afro-americanos</td>
</tr>
<tr class="odd">
<td>hispanic</td>
<td>Dummy para hispânicos</td>
</tr>
<tr class="even">
<td>married</td>
<td>Dummy para casados</td>
</tr>
<tr class="odd">
<td>re74</td>
<td>Ganhos reais (corrigidos pela inflação) para 1974</td>
</tr>
<tr class="even">
<td>re75</td>
<td>Ganhos reais (corrigidos pela inflação) para 1975</td>
</tr>
<tr class="odd">
<td>re78</td>
<td>Ganhos reais (corrigidos pela inflação) para 1978</td>
</tr>
<tr class="even">
<td>u74</td>
<td>Dummy para desempregados em 1974</td>
</tr>
<tr class="odd">
<td>u75</td>
<td>Dummy para desempregados em 1975</td>
</tr>
<tr class="even">
<td>u78</td>
<td>Dummy para desempregados em 1978</td>
</tr>
</tbody>
</table>
<p>Ao final, também analisaremos uma pequena base de <em>survey</em> retirada de <span class="citation" data-cites="ballard2017structure">Ballard-Rosa, Martin, e Scheve (<a href="#ref-ballard2017structure" role="doc-biblioref">2017</a>)</span>, sobre as preferências em relação a diferentes regimes de taxação nos EUA usando um <em>conjoint experiment</em>.</p>
</section>
<section id="estimador-de-diferença-de-médias" class="level2">
<h2 class="anchored" data-anchor-id="estimador-de-diferença-de-médias">Estimador de diferença de médias</h2>
<p>O primeiro estimador que aplicaremos é o estimador de diferença de médias. Seja <span class="math inline">\(Y_i\)</span> o valor observado da variável dependente para o indivíduo <span class="math inline">\(i\)</span>, <span class="math inline">\(D_i \in \{1, 0\}\)</span> o seu <em>status</em> de tratamento, <span class="math inline">\(N_1\)</span> e <span class="math inline">\(N_0\)</span> o número de unidades tratadas e não-tradas, o estimador de diferença de médias é:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p><span class="math display">\[
\hat{\tau} = \left(\frac{1}{N_1} \sum_{i:D_i=1} Y_i\right) - \left(\frac{1}{N_0} \sum_{i:D_i=0} Y_i\right)
\]</span></p>
<p>Em termos de implementação, portanto, ele é simples: basta calcular a diferença entre a média da variável dependente para os grupos de tratamento e controle. Podemos fazer isso em <code>R</code> em duas etapas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula a média de renda futura e erro-padrao</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>medias <span class="ot">&lt;-</span> nsw_exp <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(nsw) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">media =</span> <span class="fu">mean</span>(re78))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>medias</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
    nsw media
  &lt;dbl&gt; &lt;dbl&gt;
1     0 4555.
2     1 6349.</code></pre>
</div>
</div>
<p>Como dá para ver, a média do grupo tratado é maior do que a média do grupo de controle. Para calcular a diferença, podemos usar agora:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula a diferenca de médias</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>medias <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">diff =</span> <span class="fu">diff</span>(media))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
   diff
  &lt;dbl&gt;
1 1794.</code></pre>
</div>
</div>
<p>Ou, de forma mais direta usando apenas <code>R-base</code> e um teste T:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula a diferenca de médias</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(re78 <span class="sc">~</span> nsw, <span class="at">data =</span> nsw_exp)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  re78 by nsw
t = -2.6741, df = 307.13, p-value = 0.007893
alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
95 percent confidence interval:
 -3114.6754  -474.0108
sample estimates:
mean in group 0 mean in group 1 
       4554.802        6349.145 </code></pre>
</div>
</div>
<section id="teste-de-diferença-de-médias" class="level3">
<h3 class="anchored" data-anchor-id="teste-de-diferença-de-médias">Teste de diferença de médias</h3>
<p>No mais das vezes, estamos interessados em usar o estimador de diferença de médias para inferência e teste de hipóteses – o que significa que precisaremos calcular medidas de incerteza de estimativas e, também, P-valores. Dados que média é um estimador simples, também é simples fazer esses cálculos adicionais diretamente, sem a necessidade de funções prontas ou pacotes. Como visto em <em>Lego I</em>, variância nada mais é do que uma espécie de média dos desvios quadrados de cada valor <span class="math inline">\(Y_i\)</span> em relação à média <span class="math inline">\(\bar{Y}\)</span>. Para o grupo de tratamento, isto é o mesmo que:</p>
<p><span class="math display">\[
s_1^2 = \frac{1}{N_1 - 1} \sum_{i:D_i = 1} ​(Y_i - \bar{Y}_1)^2
\]</span></p>
<p>Tendo esse número para os dois grupos, basta dividir cada um por <span class="math inline">\(N_1\)</span> e <span class="math inline">\(N_0\)</span>, somar o resultado e tirar a sua raiz (cobriremos isso em aula, mas <span class="citation" data-cites="gerber2012field">Gerber e Green (<a href="#ref-gerber2012field" role="doc-biblioref">2012</a>)</span> detalha o procedimento no capítulo 3):</p>
<p><span class="math display">\[
\hat{\sigma} = \sqrt{\frac{s_1^2}{N_1} + \frac{s_0^2}{N_0}}
\]</span></p>
<p>De forma geral, portanto, precisamos realizar os seguintes procedimentos para calcular estatísticas de interesse e testar a hipótese de que a média dos grupos de tratamento e controle são iguais (a nossa hipótese nula):</p>
<ol type="1">
<li>Calculamos a média de cada grupo</li>
<li>Calculamos a variância de cada grupo</li>
<li>Dividimos a variância de cada grupo pelo tamanho do grupo</li>
<li>Calculamos o erro-padrão da estimativa como a raiz da soma dos resultados do passo 3</li>
<li>Usamos o erro-padrão para calcular T-valor, intervalos de confiança e P-valor</li>
</ol>
<p>O passo 2, a variância, nada mais é do que uma média dos desvios quadrados de cada valor <span class="math inline">\(Y_{i:D_i=d}\)</span> em relação à média do grupo <span class="math inline">\(d\)</span>. Em termos de implementação, podemos fazer isso em <code>R</code> da seguinte forma:<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula a variacia do grupo de tratamento</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> nsw_exp<span class="sc">$</span>re78[nsw_exp<span class="sc">$</span>nsw <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(nsw_exp<span class="sc">$</span>re78[nsw_exp<span class="sc">$</span>nsw <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(var1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="fu">length</span>(var1) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula a variacia do grupo de controle</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>var0 <span class="ot">&lt;-</span> nsw_exp<span class="sc">$</span>re78[nsw_exp<span class="sc">$</span>nsw <span class="sc">==</span> <span class="dv">0</span>] <span class="sc">-</span> <span class="fu">mean</span>(nsw_exp<span class="sc">$</span>re78[nsw_exp<span class="sc">$</span>nsw <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>var0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(var0<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="fu">length</span>(var0) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>var1</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 61896056</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>var0</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30072467</code></pre>
</div>
</div>
<p>O passo 3, a divisão da variância pelo tamanho do grupo, é simples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide a variância pelo tamanho do grupo</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> var1 <span class="sc">/</span> <span class="fu">length</span>(nsw_exp<span class="sc">$</span>re78[nsw_exp<span class="sc">$</span>nsw <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>var0 <span class="ot">&lt;-</span> var0 <span class="sc">/</span> <span class="fu">length</span>(nsw_exp<span class="sc">$</span>re78[nsw_exp<span class="sc">$</span>nsw <span class="sc">==</span> <span class="dv">0</span>])</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isso feito, podemos calcular o erro-padrão da estimativa somando <code>var1</code> e <code>var0</code> e tirando a sua raiz quadrada:<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula o erro-padrão</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>erro <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var1 <span class="sc">+</span> var0)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>erro</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 670.9967</code></pre>
</div>
</div>
<p>O erro-padrão é, portanto, de aproximadamente 671. Com isso, podemos calcular o T-valor, intervalos de confiança e P-valor:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula o t-valor</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>diferenca <span class="ot">&lt;-</span> <span class="fu">mean</span>(nsw_exp<span class="sc">$</span>re78[nsw_exp<span class="sc">$</span>nsw <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">mean</span>(nsw_exp<span class="sc">$</span>re78[nsw_exp<span class="sc">$</span>nsw <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> diferenca <span class="sc">/</span> erro</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.674146</code></pre>
</div>
</div>
<p>De cara, dado que <span class="math inline">\(t &gt; 1.96\)</span>, fica patente que o efeito não parece ser um que ocorreria por acaso, em função da aleatoriedade do Processo Gerador de Dados. Mas podemos calcular o intervalo de confiança e o P-valor para ter um número mais formal:<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula o p-valor</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(t), <span class="at">df =</span> <span class="fu">nrow</span>(nsw_exp) <span class="sc">-</span> <span class="dv">2</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.007769016</code></pre>
</div>
</div>
<p>O cálculo acima é mais complicado (dado que envolve a distribuição cumulativa de uma distribuição <span class="math inline">\(t\)</span>), mas o intervalo de confiança é simples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula o IC</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>diferenca <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> <span class="fu">nrow</span>(nsw_exp) <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">*</span> erro</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  475.6108 3113.0754</code></pre>
</div>
</div>
<p>Como é possível ver, o resultado é o mesmo que o obtido com <code>t.test</code> anteriormente (embora com os sinais trocados por conta da ordem em que consideramos os grupos).</p>
</section>
</section>
<section id="estimador-de-regressão-linear" class="level2">
<h2 class="anchored" data-anchor-id="estimador-de-regressão-linear">Estimador de regressão linear</h2>
<p>Podemos realizar o mesmo teste com modelos de regressão linear – o que, adicionalmente, nos dá a vantagem de termos maior controle sobre o tipo de erro-padrão, se é necessário controlar alguma variável para assumir que <span class="math inline">\((Y_i(1), Y_i(0)) \not\!\!\perp\!\!\!\perp D_i\)</span>, etc. Para facilitar as coisas, usaremos o pacote <code>fixest</code> para reestimar o efeito do programa de treinamento profissional sobre a renda futura dos participantes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o efeito do programa</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(re78 <span class="sc">~</span> nsw, <span class="at">data =</span> nsw_exp)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: re78
Observations: 445 
Standard-errors: IID 
            Estimate Std. Error  t value  Pr(&gt;|t|)    
(Intercept)  4554.80    408.046 11.16247 &lt; 2.2e-16 ***
nsw          1794.34    632.854  2.83532 0.0047875 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 6,564.7   Adj. R2: 0.015606</code></pre>
</div>
</div>
<p>O resulta dispensa muitos comentários. O principal aqui é que o coeficiente de <code>nsw</code> retornou o mesmo que um estimador de diferença de médias, a estimativa de erro-padrão é similar e, da mesma forma, a estatística T e o P-valor. Podemos ir além e incluir, agora, variáveis de controle:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o efeito do programa</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(re78 <span class="sc">~</span> nsw <span class="sc">+</span> age <span class="sc">+</span> educ <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> married <span class="sc">+</span> u74, <span class="at">data =</span> nsw_exp)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: re78
Observations: 445 
Standard-errors: IID 
              Estimate Std. Error   t value  Pr(&gt;|t|)    
(Intercept)  1293.8046  2518.6714  0.513685 0.6077316    
nsw          1660.4761   632.8607  2.623762 0.0090008 ** 
age            57.4934    45.1431  1.273579 0.2034895    
educ          400.6857   176.6569  2.268158 0.0238068 *  
black       -2248.5264  1159.4094 -1.939372 0.0530993 .  
hisp           21.1637  1548.1689  0.013670 0.9890994    
married        95.9200   852.7368  0.112485 0.9104906    
u74          -505.8836   710.1823 -0.712329 0.4766411    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 6,459.8   Adj. R2: 0.033726</code></pre>
</div>
</div>
<p>Como é possível ver, o efeito do programa continua similar, mesmo com a inclusão de variáveis de controle – o que é um resultado da aleatorização do tratamento, que é independente de outras variáveis. Inversamente, o tratamento não deve ter efeito sobre variáveis pré-tratamento, isto é, variáveis que ocorreram antes da administração do programa de treinamento. Podemos checar isso com dois modelos, a título de exemplo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o efeito do programa</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>pre1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(age <span class="sc">~</span> nsw <span class="sc">+</span> educ <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> married <span class="sc">+</span> u74, <span class="at">data =</span> nsw_exp)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>pre2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(educ <span class="sc">~</span> nsw <span class="sc">+</span> age <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> married <span class="sc">+</span> u74, <span class="at">data =</span> nsw_exp)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">etable</span>(pre1, pre2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             pre1               pre2
Dependent Var.:               age               educ
                                                    
Constant         22.40*** (2.442)  10.87*** (0.4409)
nsw               0.6137 (0.6692)    0.1696 (0.1710)
educ              0.0135 (0.1870)                   
black              0.7374 (1.227)  -0.5187. (0.3126)
hisp               -1.397 (1.637) -1.395*** (0.4134)
married         4.110*** (0.8810)    0.3628 (0.2300)
u74               1.899* (0.7462)  -0.3714. (0.1913)
age                                  0.0009 (0.0122)
_______________ _________________ __________________
S.E. type                     IID                IID
Observations                  445                445
R2                        0.06845            0.04513
Adj. R2                   0.05569            0.03205
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Nesse caso, <code>nsw</code> não tem efeito nem substantivo e nem significativo, o que sugere, realmente, que nenhuma das duas variáveis que analisamos podem ser preditas pelo tratamento.</p>
<section id="estimativa-com-dados-observacionais" class="level3">
<h3 class="anchored" data-anchor-id="estimativa-com-dados-observacionais">Estimativa com dados observacionais</h3>
<p>Para fechar esta parte, vamos estimar o mesmo efeito com dados observacionais, usando o mesmo modelo de regressão linear. Para isso, usaremos a base <code>nsw_obs</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o efeito do programa</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">feols</span>(re78 <span class="sc">~</span> nsw <span class="sc">+</span> age <span class="sc">+</span> educ <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> married <span class="sc">+</span> u74, <span class="at">data =</span> nsw_obs)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: re78
Observations: 2,675 
Standard-errors: IID 
              Estimate Std. Error    t value   Pr(&gt;|t|)    
(Intercept)  -9119.878  1785.5512  -5.107598 3.4930e-07 ***
nsw           3132.613  1319.5522   2.373997 1.7667e-02 *  
age            233.467    26.8101   8.708176  &lt; 2.2e-16 ***
educ          1747.710    93.6906  18.654072  &lt; 2.2e-16 ***
black        -3299.049   651.8200  -5.061288 4.4477e-07 ***
hisp           704.549  1442.7266   0.488346 6.2535e-01    
married       3873.129   770.2923   5.028129 5.2812e-07 ***
u74         -13790.664   883.3935 -15.611009  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 13,296.2   Adj. R2: 0.274401</code></pre>
</div>
</div>
<p>Em relação ao efeito estimado usando um desenho experimental, os dados observacionais inflam o impacto do programa de treinamento profissional – indicando que provavelmente quem procurou o programa já ganharia mais dinheiro de toda forma.</p>
</section>
</section>
<section id="estimatr" class="level2">
<h2 class="anchored" data-anchor-id="estimatr"><code>estimatr</code></h2>
<p>Para facilitar a aplicação de estimadores para desenhos experimentais, podemos usar o pacote <code>estimatr</code>, criado por um grupo de cientistas políticos e documentado <a href="https://declaredesign.org/r/estimatr/index.html">neste link</a>. Podemos instalá-lo com:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instala e carrega o pacote</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"estimatr"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(estimatr)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para o uso documentado acima, as principais funções do pacote são <code>lm_robust</code>, para estimar modelos lineares por MQO com erros-padrão robustos<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>; e <code>difference_in_means</code>, para estimar diferenças de médias. Ambas as funções são simples de usar, e retornam objetos que podem ser usados com <code>summary</code> e <code>tidy</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o efeito do programa</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>est_medias <span class="ot">&lt;-</span> <span class="fu">difference_in_means</span>(re78 <span class="sc">~</span> nsw, <span class="at">data =</span> nsw_exp)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>est_modelo <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(re78 <span class="sc">~</span> nsw <span class="sc">+</span> age <span class="sc">+</span> educ <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> married <span class="sc">+</span> u74, <span class="at">data =</span> nsw_exp)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(est_medias)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$coefficients
    Estimate Std. Error  t value    Pr(&gt;|t|) CI Lower CI Upper       DF
nsw 1794.343   670.9967 2.674146 0.007892971 474.0108 3114.675 307.1325

$design
[1] "Standard"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(est_modelo)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = re78 ~ nsw + age + educ + black + hisp + 
    married + u74, data = nsw_exp)

Standard error type:  HC2 

Coefficients:
            Estimate Std. Error  t value Pr(&gt;|t|) CI Lower CI Upper  DF
(Intercept)  1293.80    2451.86  0.52768  0.59799 -3525.09   6112.7 437
nsw          1660.48     665.45  2.49525  0.01295   352.59   2968.4 437
age            57.49      39.91  1.44065  0.15040   -20.94    135.9 437
educ          400.69     161.41  2.48242  0.01342    83.45    717.9 437
black       -2248.53    1004.58 -2.23827  0.02571 -4222.94   -274.1 437
hisp           21.16    1367.87  0.01547  0.98766 -2667.26   2709.6 437
married        95.92     880.27  0.10897  0.91328 -1634.17   1826.0 437
u74          -505.88     733.95 -0.68926  0.49102 -1948.39    936.6 437

Multiple R-squared:  0.04896 ,  Adjusted R-squared:  0.03373 
F-statistic: 3.475 on 7 and 437 DF,  p-value: 0.001234</code></pre>
</div>
</div>
<p>Como outra vantagem, podemo usar a função <code>tidy</code> para obter um <code>tibble</code> com os resultados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(est_medias)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  term estimate std.error statistic     p.value conf.low conf.high       df
1  nsw 1794.343  670.9967  2.674146 0.007892971 474.0108  3114.675 307.1325
  outcome
1    re78</code></pre>
</div>
</div>
<p>Com isso, podemos, por exemplo, fazer um gráfico dos coeficientes para facilitar a visualização – de um modelo linear, digamos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>est_modelo <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">%&gt;%</span> <span class="co"># Sem intercep</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> term, <span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high)) <span class="sc">+</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Estimativa"</span>, <span class="at">y =</span> <span class="st">"Coeficiente"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico4_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Mais útil, podemos testar o efeito do tratamento em variáveis pré-tratamento para visualizar os resultados com um gráfico (alerta: o código depende de um conhecimento maior do <code>tidyverse</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o efeito do programa</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>pre1 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(age <span class="sc">~</span> nsw <span class="sc">+</span> educ <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> married <span class="sc">+</span> u74, <span class="at">data =</span> nsw_exp) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"nsw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var =</span> <span class="st">"Idade"</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>pre2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(educ <span class="sc">~</span> nsw <span class="sc">+</span> age <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> married <span class="sc">+</span> u74, <span class="at">data =</span> nsw_exp) <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"nsw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var =</span> <span class="st">"Escolaridade"</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>pre3 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(black <span class="sc">~</span> nsw <span class="sc">+</span> age <span class="sc">+</span> educ <span class="sc">+</span> hisp <span class="sc">+</span> married <span class="sc">+</span> u74, <span class="at">data =</span> nsw_exp) <span class="sc">%&gt;%</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"nsw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var =</span> <span class="st">"Afro-americano"</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(pre1, pre2, pre3) <span class="sc">%&gt;%</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> var, <span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Estimativa"</span>, <span class="at">y =</span> <span class="st">"Coeficiente"</span>,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Efeito do tratamento em variáveis pré-tratamento"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico4_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Com a ajuda de outros pacotes, também é fácil exportar os resultados de <code>estimatr</code> para tabelas. Por exemplo, podemos usar o pacote <code>modelsummary</code>, que já vimos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>est_modelo_simples <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(re78 <span class="sc">~</span> nsw, <span class="at">data =</span> nsw_exp)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(est_modelo_simples, est_modelo), </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="cn">TRUE</span>, </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">statistic =</span> <span class="st">"p.value"</span>, <span class="at">output =</span> <span class="st">"markdown"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_map =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span> <span class="ot">=</span> <span class="st">"Constante"</span>, <span class="st">"nsw"</span> <span class="ot">=</span> <span class="st">"Tratamento"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">(1)</th>
<th style="text-align: right;">(2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constante</td>
<td style="text-align: right;">4554.802***</td>
<td style="text-align: right;">1293.805</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: right;">(&lt;0.001)</td>
<td style="text-align: right;">(0.598)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tratamento</td>
<td style="text-align: right;">1794.343**</td>
<td style="text-align: right;">1660.476*</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: right;">(0.008)</td>
<td style="text-align: right;">(0.013)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">:———–</td>
<td style="text-align: right;">————:</td>
<td style="text-align: right;">———-:</td>
</tr>
<tr class="even">
<td style="text-align: left;">Num.Obs.</td>
<td style="text-align: right;">445</td>
<td style="text-align: right;">445</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: right;">0.018</td>
<td style="text-align: right;">0.049</td>
</tr>
<tr class="even">
<td style="text-align: left;">R2 Adj.</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.034</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AIC</td>
<td style="text-align: right;">9091.5</td>
<td style="text-align: right;">9089.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">BIC</td>
<td style="text-align: right;">9103.8</td>
<td style="text-align: right;">9126.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RMSE</td>
<td style="text-align: right;">6564.74</td>
<td style="text-align: right;">6459.85</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> ^^ + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</p>
</div>
</div>
</section>
<section id="efeito-marginal-do-componente-amce" class="level2">
<h2 class="anchored" data-anchor-id="efeito-marginal-do-componente-amce">Efeito marginal do componente (AMCE)</h2>
<p>Nesta última seção, veremos rapidamente como aplicar regressão linear para estimar o efeito marginal do componente (AMCE) de um tratamento. Para isso, usaremos uma base de dados retirada de <span class="citation" data-cites="ballard2017structure">Ballard-Rosa, Martin, e Scheve (<a href="#ref-ballard2017structure" role="doc-biblioref">2017</a>)</span>, <a href="../docs/data/taxes.csv">disponível aqui</a>, que contém as preferências de indivíduos em relação a diferentes regimes de taxação nos EUA. A base contém poucas variáveis, mas é para ilustrar o estimador. Começamos carregando os dados que estão em CSV:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Carrega os dados</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>taxes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"taxes.csv"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos ver a estrutura da base com:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostra a estrutura da base</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(taxes)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 32,000
Columns: 13
$ chose_plan          &lt;dbl&gt; 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0,…
$ taxrate1            &lt;chr&gt; "&lt;10k: 5%", "&lt;10k: 0%", "&lt;10k: 15%", "&lt;10k: 15%", …
$ taxrate2            &lt;chr&gt; "10-35k: 25%", "10-35k: 35%", "10-35k: 25%", "10-3…
$ taxrate3            &lt;chr&gt; "35-85k: 35%", "35-85k: 5%", "35-85k: 5%", "35-85k…
$ taxrate4            &lt;chr&gt; "85-175k: 25%", "85-175k: 15%", "85-175k: 25%", "8…
$ taxrate5            &lt;chr&gt; "175-375k: 15%", "175-375k: 5%", "175-375k: 25%", …
$ taxrate6            &lt;chr&gt; "&gt;375k: 5%", "&gt;375k: 45%", "&gt;375k: 25%", "&gt;375k: 5…
$ taxrev              &lt;chr&gt; "95-105%", "105-125%", "95-105%", "75-95%", "105-1…
$ inequality_aversion &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,…
$ taxes_harm_economy  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,…
$ partyid             &lt;chr&gt; "Republican", "Republican", "Republican", "Republi…
$ ID                  &lt;dbl&gt; 177191531, 177191531, 177191531, 177191531, 177191…
$ weight              &lt;dbl&gt; 6.828660, 6.828660, 6.828660, 6.828660, 6.828660, …</code></pre>
</div>
</div>
<p>Como dá para ver, temos como variável dependente <code>choose_plan</code>, que indica se um perfil hipotético de política de taxação foi (1) ou não (0) selecionado. Os perfis são definidos por seis componentes iniciados <code>tax</code> (e.g., <code>taxrate1</code>, <code>taxrate2</code>), que indicam a alíquota sugerida para cada faixa de renda anual.</p>
<p>Isso feito, o estimador do AMCE é apenas uma variação do que já vimos: estimamos um modelo de regressão linear com os diferentes atributos aleatorizados como tratamento. Por exemplo, para estimar o AMCE do componente <code>tax</code> (que é a taxa de imposto), usamos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cj <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(chose_plan <span class="sc">~</span> taxrate1 <span class="sc">+</span> taxrate2 <span class="sc">+</span> taxrate3 <span class="sc">+</span> taxrate4 <span class="sc">+</span> taxrate5 <span class="sc">+</span> taxrate6, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">clusters =</span> ID, <span class="at">data =</span> taxes)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>cj</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          Estimate  Std. Error     t value      Pr(&gt;|t|)
(Intercept)            0.621875367 0.013123197  47.3874914 1.722575e-315
taxrate1&lt;10k: 15%     -0.073108439 0.008459878  -8.6417841  1.159886e-17
taxrate1&lt;10k: 25%     -0.193712404 0.008835955 -21.9231989  4.624763e-95
taxrate1&lt;10k: 5%      -0.008562999 0.008175335  -1.0474188  2.950413e-01
taxrate210-35k: 25%   -0.043072217 0.007985812  -5.3935926  7.780535e-08
taxrate210-35k: 35%   -0.123779054 0.008544427 -14.4865247  3.583595e-45
taxrate210-35k: 5%    -0.002254620 0.007803330  -0.2889305  7.726663e-01
taxrate335-85k: 25%   -0.044727169 0.007693865  -5.8133547  7.172618e-09
taxrate335-85k: 35%   -0.090762797 0.008169538 -11.1099062  8.043787e-28
taxrate335-85k: 5%    -0.009194678 0.007836756  -1.1732760  2.408336e-01
taxrate485-175k: 25%  -0.005424936 0.007891790  -0.6874152  4.919060e-01
taxrate485-175k: 35%  -0.015025665 0.008002930  -1.8775204  6.060145e-02
taxrate485-175k: 5%   -0.022240453 0.007672150  -2.8988554  3.788648e-03
taxrate5175-375k: 25%  0.014401264 0.008604154   1.6737571  9.434932e-02
taxrate5175-375k: 35%  0.038231552 0.008857437   4.3163222  1.671375e-05
taxrate5175-375k: 45%  0.013157327 0.009096260   1.4464547  1.482212e-01
taxrate5175-375k: 5%  -0.040737725 0.008604726  -4.7343429  2.366839e-06
taxrate6&gt;375k: 25%     0.034774843 0.009517663   3.6537164  2.659657e-04
taxrate6&gt;375k: 35%     0.071922962 0.009670997   7.4369749  1.595445e-13
taxrate6&gt;375k: 45%     0.088864878 0.010306640   8.6220996  1.425409e-17
taxrate6&gt;375k: 5%     -0.077717384 0.009479144  -8.1987770  4.601144e-16
taxrate6&gt;375k: 55%     0.067500551 0.010689116   6.3148864  3.406463e-10
                          CI Lower      CI Upper       DF
(Intercept)            0.596136474  0.6476142598 1740.356
taxrate1&lt;10k: 15%     -0.089700148 -0.0565167299 1885.128
taxrate1&lt;10k: 25%     -0.211041707 -0.1763831017 1881.361
taxrate1&lt;10k: 5%      -0.024596696  0.0074706979 1877.659
taxrate210-35k: 25%   -0.058734224 -0.0274102098 1876.297
taxrate210-35k: 35%   -0.140536583 -0.1070215244 1884.963
taxrate210-35k: 5%    -0.017558684  0.0130494438 1886.499
taxrate335-85k: 25%   -0.059816538 -0.0296377991 1888.578
taxrate335-85k: 35%   -0.106785090 -0.0747405034 1883.958
taxrate335-85k: 5%    -0.024564318  0.0061749624 1882.795
taxrate485-175k: 25%  -0.020902535  0.0100526622 1877.969
taxrate485-175k: 35%  -0.030721220  0.0006698906 1880.876
taxrate485-175k: 5%   -0.037287267 -0.0071936401 1882.228
taxrate5175-375k: 25% -0.002473734  0.0312762613 1829.204
taxrate5175-375k: 35%  0.020859795  0.0556033096 1828.391
taxrate5175-375k: 45% -0.004682828  0.0309974829 1827.676
taxrate5175-375k: 5%  -0.057613856 -0.0238615944 1827.547
taxrate6&gt;375k: 25%     0.016107861  0.0534418250 1778.383
taxrate6&gt;375k: 35%     0.052955219  0.0908907050 1774.569
taxrate6&gt;375k: 45%     0.068650519  0.1090792373 1783.809
taxrate6&gt;375k: 5%     -0.096308837 -0.0591259307 1775.553
taxrate6&gt;375k: 55%     0.046536010  0.0884650917 1779.517</code></pre>
</div>
</div>
<p>Vale notar que, como os diferentes tratamentos são independentes uns dos outros, estimar apenas uma versão reduzida do experimento resulta em estimativas similares:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>cj2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(chose_plan <span class="sc">~</span> taxrate1, <span class="at">clusters =</span> ID, <span class="at">data =</span> taxes)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>cj2</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Estimate  Std. Error     t value     Pr(&gt;|t|)    CI Lower
(Intercept)        0.568902362 0.005405219 105.2505573 0.000000e+00  0.55830072
taxrate1&lt;10k: 15% -0.073439341 0.008580787  -8.5585788 2.329752e-17 -0.09026818
taxrate1&lt;10k: 25% -0.194073702 0.008921331 -21.7538954 8.858244e-94 -0.21157044
taxrate1&lt;10k: 5%  -0.007065347 0.008268703  -0.8544686 3.929544e-01 -0.02328216
                      CI Upper       DF
(Intercept)        0.579504005 1686.775
taxrate1&lt;10k: 15% -0.056610506 1885.640
taxrate1&lt;10k: 25% -0.176576959 1881.638
taxrate1&lt;10k: 5%   0.009151463 1878.486</code></pre>
</div>
</div>
<p>Novamente, podemos fazer um gráfico dos resultados para simplificar a visualização<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>cj <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">" 5%"</span>, <span class="st">" 05%"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> term, <span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high)) <span class="sc">+</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Estimativa"</span>, <span class="at">y =</span> <span class="st">"Coeficiente"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico4_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Referências</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-ballard2017structure" class="csl-entry" role="listitem">
Ballard-Rosa, Cameron, Lucy Martin, e Kenneth Scheve. 2017. <span>«The structure of American income tax policy preferences»</span>. <em>The Journal of Politics</em> 79 (1): 1–16.
</div>
<div id="ref-gerber2012field" class="csl-entry" role="listitem">
Gerber, Alan S, e Donald P Green. 2012. <span>«Field experiments: Design, analysis, and interpretation»</span>. <em>(No Title)</em>.
</div>
<div id="ref-lalonde1986evaluating" class="csl-entry" role="listitem">
LaLonde, Robert J. 1986. <span>«Evaluating the econometric evaluations of training programs with experimental data»</span>. <em>The American economic review</em>, 604–20.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notas de rodapé</h2>

<ol>
<li id="fn1"><p>Note que usamos <span class="math inline">\(i:D_i=1\)</span> para indicar que a média é calculada apenas para os indivíduos tratados, isto é, o indexador <span class="math inline">\(i\)</span> pula observações com <span class="math inline">\(D_i=0\)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>No cálculo de variância, em vez de dividir a soma dos desvios quadrados pelo número de elementos, usamos como denominador o número de elementos menos 1 – dado que já estimamos a média do grupo, que é um parâmetro. Informalmente, isso significa dizer que já gastamos uma observação.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>A título de intuição, quando temos duas amostras independentes o erro-padrão da diferença de estimativas é uma espécie de soma de suas medidas de dispersão. Um exemplo: imagine duas pesquisas eleitorais que dizem que a candidata A tem 20% de intenção de votos, com margem de erro de 2 pontos percentuais; e outra que diz que ela subiu para 22% da intenção de votos, com margem também de 2pp; nesse caso, a diferença entre as estimativas da candidata A pode ser tanto de 2pp (<span class="math inline">\(0.22 - 0.2 = 2pp\)</span>) quanto de 6pp (<span class="math inline">\(0.18 - 0.24 = -6pp\)</span>).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Aqui, os graus de liberdade são indicados por <code>df</code>. Note que diminuímos o número de observações, agora, de 2 dado que <a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Não cobrimos tanto inferência nesse curso, embora seja um tópico fundamental; de toda forma, erros-padrão robustos são úteis para o caso em que acreditamos (ou temos evidência) de que a variação dos resíduos não é homogênea. Para uma explicação formal, ver <a href="https://en.wikipedia.org/wiki/Heteroskedasticity-consistent_standard_errors">esta página</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>O <code>ggplot</code> automaticamente ordenar em orderm alfabética variáveis <code>character</code>, o que é o caso de <code>term</code>; de toda forma, ao fazer isso “5%” é considerado posterior a “25%”; mudaremos isso usando <code>str_replace</code> para trocar ” 5%” por “05%”.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>