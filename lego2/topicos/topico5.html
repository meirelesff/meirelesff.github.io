<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lego II - Regressão descontínua</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="Lego II - Regressão descontínua">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="topico5_files/figure-html/unnamed-chunk-5-1.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Lego II</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Procurar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Alternar de navegação" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../template.html" rel="" target="">
 <span class="menu-text">Template</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tópicos" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Tópicos</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tópicos">    
        <li>
    <a class="dropdown-item" href="../topicos/topico1.html" rel="" target="">
 <span class="dropdown-text">Simulações</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../topicos/topico2.html" rel="" target="">
 <span class="dropdown-text">Regressão linear simples</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../topicos/topico3.html" rel="" target="">
 <span class="dropdown-text">Regressão linear múltipla</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../topicos/topico4.html" rel="" target="">
 <span class="dropdown-text">Experimentos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../topicos/topico5.html" rel="" target="">
 <span class="dropdown-text">Regressão descontínua</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../topicos/topico6.html" rel="" target="">
 <span class="dropdown-text">Diferença-em-diferenças</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-replicações" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Replicações</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-replicações">    
        <li>
    <a class="dropdown-item" href="../replicacao/replicacao1.html" rel="" target="">
 <span class="dropdown-text">Replicação I</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../replicacao/replicacao2.html" rel="" target="">
 <span class="dropdown-text">Replicação II</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="http://www.github.com/meirelesff" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Nesta página</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução">Introdução</a></li>
  <li><a href="#regressão-global" id="toc-regressão-global" class="nav-link" data-scroll-target="#regressão-global">Regressão global</a>
  <ul class="collapse">
  <li><a href="#um-modelo-linear-rígido" id="toc-um-modelo-linear-rígido" class="nav-link" data-scroll-target="#um-modelo-linear-rígido">Um modelo linear rígido</a></li>
  <li><a href="#um-modelo-flexível" id="toc-um-modelo-flexível" class="nav-link" data-scroll-target="#um-modelo-flexível">Um modelo flexível</a></li>
  </ul></li>
  <li><a href="#regressão-local" id="toc-regressão-local" class="nav-link" data-scroll-target="#regressão-local">Regressão local</a></li>
  <li><a href="#janela" id="toc-janela" class="nav-link" data-scroll-target="#janela">Janela</a></li>
  <li><a href="#rdrobust" id="toc-rdrobust" class="nav-link" data-scroll-target="#rdrobust"><code>rdrobust</code></a></li>
  <li><a href="#especificação-e-exportação" id="toc-especificação-e-exportação" class="nav-link" data-scroll-target="#especificação-e-exportação">Especificação e exportação</a>
  <ul class="collapse">
  <li><a href="#tabelas-com-modelos-diferentes" id="toc-tabelas-com-modelos-diferentes" class="nav-link" data-scroll-target="#tabelas-com-modelos-diferentes">Tabelas com modelos diferentes</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Regressão descontínua</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introdução" class="level2">
<h2 class="anchored" data-anchor-id="introdução">Introdução</h2>
<p>Estas notas cobrem como estimar efeitos causais locais usando estratégias de regressão descontínua. Como o nome canônico da estratégia sugere, usaremos modelos de regressão para isso, mas também veremos como usar o pacote <code>rdrobust</code> que implementa um estimador mais adequado, que dá mais peso para observações próximas à descontinuidade; seleciona uma janela ótima para estimação; e usa polinômios. Para praticar, usaremos dados simulados e, também, a base de dados de <span class="citation" data-cites="lee2008randomized">Lee (<a href="#ref-lee2008randomized" role="doc-biblioref">2008</a>)</span>, disponíveis <a href="../docs/data/lee.rda">aqui</a> e que podem ser carregados com:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"lee.rda"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Também precisaremos instalar o pacote <code>rdrobust</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"rdrobust"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Instalar também um pacote que criei para facilitar a criação de tabelas com resultados de RDD<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(remotes)) <span class="fu">install.packages</span>(<span class="st">"remotes"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"meirelesff/iesp"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>E carregar pacotes necessários:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary) <span class="co"># Tabelas de regressão</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rdrobust)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(iesp) <span class="co"># Necessário pra termos tabelas de RDD</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="regressão-global" class="level2">
<h2 class="anchored" data-anchor-id="regressão-global">Regressão global</h2>
<p>Comumente, RDD é descrita como a diferença vertical, em unidades de <span class="math inline">\(Y\)</span>, entre duas curvas (ou regressão) estimadas de cada lado de uma descontinuidade que atribui algum tratamento quando <span class="math inline">\(X \geq c\)</span> <span class="citation" data-cites="skovron2015practical">(ver <a href="#ref-skovron2015practical" role="doc-biblioref">Skovron e Titiunik 2015</a>)</span>. Na prática, isso significa estimar um modelo de regressão linear por mínimos quadrados que permita que a reta da relação entre <span class="math inline">\(Y\)</span> e <span class="math inline">\(X\)</span> varie em cada lado de <span class="math inline">\(c\)</span>.</p>
<p>Para exemplificar a ideia, podemos simular um PGD no qual temos uma variável <span class="math inline">\(X \sim Normal(0, 1)\)</span> (i.e., média zero, desvio de 1) e que gere <span class="math inline">\(Y_i\)</span> como <span class="math inline">\(Y_i \sim X_i*0.8 + \epsilon_i\)</span>, em que <span class="math inline">\(\epsilon_i \sim Normal(0, 1)\)</span> é um erro aleatório. O código para simular sorteios desse processo e plotar os resultados é:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Isso serve para replicarmos o sorteio</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simula os dados</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> x<span class="sc">*</span><span class="fl">0.8</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plota</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>dados <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico5_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Como dá para ver, temos uma relação bivariada positiva, no sentido de que <span class="math inline">\(Y_i | X_i\)</span>, isto é, a média condicional de <span class="math inline">\(Y_i\)</span> depende de valores de <span class="math inline">\(X_i\)</span>. Com isso, estamos a um passo de entender um PGD comum em descontinuidades: a única diferença é que temos também um tratamento, <span class="math inline">\(D_i \in \{1, 0\}\)</span>, que é recebido apenas por unidades <span class="math inline">\(_i\)</span> que tiverem valores de <span class="math inline">\(X_i\)</span> maiores do que um ponto de corte qualquer, <span class="math inline">\(c\)</span>. Se <span class="math inline">\(c=0\)</span>, por exemplo, <span class="math inline">\(D_{i:X_i &gt; c} = 1\)</span>.</p>
<p>Podemos atualizar nosso PGD com essa nova variável, assumindo que o tratamento causa um aumento de <span class="math inline">\(2\)</span> pontos em <span class="math inline">\(Y_i\)</span>, isto é, <span class="math inline">\(Y_i \sim X_i*0.8 + 2 * (X_i &gt; c) + \epsilon_i\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simula os dados</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> <span class="fu">as.numeric</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> x<span class="sc">*</span><span class="fl">0.2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>d <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plota</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>dados <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">as.factor</span>(d))) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#EF2D56"</span>, <span class="st">"#363537"</span>)) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Tratamento (D)"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico5_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Entendendo como simular um PGD que atribui um tratamento descontinuamente<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, podemos passar para a estimação do efeito que estipulamos, <span class="math inline">\(\hat{\tau} = 2\)</span>.</p>
<section id="um-modelo-linear-rígido" class="level3">
<h3 class="anchored" data-anchor-id="um-modelo-linear-rígido">Um modelo linear rígido</h3>
<p>Uma primeira tentativa de estimar o efeito local no nosso exemplo anterior é rodar uma regressão incluindo a variável de tratamento, <span class="math inline">\(D_i\)</span>, e <span class="math inline">\(X_i\)</span>. O código para isso é:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o modelo</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> d, <span class="at">data =</span> dados)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + d, data = dados)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.36217 -0.69477  0.02199  0.67711  2.74985 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.09237    0.14299   0.646  0.51900    
x            0.32557    0.12354   2.635  0.00907 ** 
d            1.77689    0.23822   7.459 2.72e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.027 on 197 degrees of freedom
Multiple R-squared:  0.5604,    Adjusted R-squared:  0.556 
F-statistic: 125.6 on 2 and 197 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>A estimativa de <span class="math inline">\(\hat{\tau}\)</span> é bem próxima, mas vale investigarmos visualmente o que esse modelo estimou:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plota</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dados <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">as.factor</span>(d))) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F, <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> (x <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#EF2D56"</span>, <span class="st">"#363537"</span>)) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Tratamento (D)"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico5_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Pelo gráfico, talvez dê para perceber o seguinte: a inclinação da reta (o <em>slope</em>), ou o coeficiente de <code>x</code>, é o mesmo dos dois lados da descontinuidade. Como <span class="math inline">\(\hat{\beta_0}\)</span> indica a média de <span class="math inline">\(Y_i\)</span> quando <span class="math inline">\(X_i=0\)</span>, essa é valor estimado de <span class="math inline">\(Y_i\)</span> quando <span class="math inline">\(lim_{X_i \uparrow c}\)</span>; por outro lado, o efeito estimado de <span class="math inline">\(D_i\)</span> (<span class="math inline">\(\hat{beta_2}\)</span>) indica o efeito médio local, que é o quanto a reta sobe (ou desce) quando <span class="math inline">\(X_i\)</span> passa de <span class="math inline">\(c\)</span> para <span class="math inline">\(c+1\)</span> – a nossa estimativa de <span class="math inline">\(lim_{X_i \downarrow c}\)</span> é <span class="math inline">\(\hat{\beta_0} + \hat{beta_2}\)</span> e, portanto,</p>
<p><span class="math display">\[
\hat{\tau}_{RDD} = \hat{\beta_0} + \hat{\beta_2} - \hat{\beta_0} = \hat{\beta_2}
\]</span></p>
</section>
<section id="um-modelo-flexível" class="level3">
<h3 class="anchored" data-anchor-id="um-modelo-flexível">Um modelo flexível</h3>
<p>No mais das vezes, não podemos assumir que a relação entre <span class="math inline">\(Y | X\)</span> é a mesma dos dois lados da descontinuidade. Para lidar com isso, podemos estimar um modelo flexível, que permita que a reta de regressão varie em cada lado de <span class="math inline">\(c\)</span>, incluindo um termo multiplicativo adicional:</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 X_i + \beta_2 D_i + \beta_3 X_i D_i + \epsilon_i
\]</span></p>
<p>Incluindo o coeficiente <span class="math inline">\(\beta_3\)</span>, estamos permitindo que a inclinação da reta varie em cada lado de <span class="math inline">\(c\)</span>. O código para estimar esse novo modelo é:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o modelo</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> d <span class="sc">+</span> x<span class="sc">*</span>d, <span class="at">data =</span> dados)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + d + x * d, data = dados)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.28380 -0.68065  0.03589  0.67026  2.76755 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.12503    0.16818   0.743   0.4581    
x            0.36758    0.16779   2.191   0.0297 *  
d            1.78186    0.23912   7.452 2.88e-12 ***
x:d         -0.09223    0.24861  -0.371   0.7111    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.029 on 196 degrees of freedom
Multiple R-squared:  0.5608,    Adjusted R-squared:  0.554 
F-statistic: 83.41 on 3 and 196 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>O novo gráfico:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotando os dados</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>dados <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">as.factor</span>(d), <span class="at">group =</span> d)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#EF2D56"</span>, <span class="st">"#363537"</span>)) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Tratamento (D)"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico5_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A diferença entre retas é pouco perceptível nesse exemplo, mas considere o seguinte:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simula os dados</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> <span class="fu">as.numeric</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> x<span class="sc">*</span><span class="fl">0.2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>d <span class="sc">+</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>x<span class="sc">*</span>d <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o modelo</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>rigido <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">+</span> d, <span class="at">data =</span> dados)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>flexivel <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">+</span> d <span class="sc">+</span> x<span class="sc">*</span>d, <span class="at">data =</span> dados)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">etable</span>(rigido, flexivel, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           rigido        flexivel
Dependent Var.:                 y               y
                                                 
Constant         -0.443** (0.134)  -0.242 (0.171)
x               -0.512*** (0.112)  -0.255 (0.176)
d                 2.19*** (0.231) 2.13*** (0.232)
x x d                             -0.428. (0.227)
_______________ _________________ _______________
S.E. type                     IID             IID
Observations                  200             200
R2                        0.36055         0.37193
Adj. R2                   0.35405         0.36232
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>A diferença é ínfima, mas, visualmente, é perceptível:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plota os dados</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dados <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">as.factor</span>(d))) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F, <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> (x <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F, <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> (x <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">+</span> x<span class="sc">*</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"#E03616"</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#EF2D56"</span>, <span class="st">"#363537"</span>)) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Tratamento (D)"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico5_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="regressão-local" class="level2">
<h2 class="anchored" data-anchor-id="regressão-local">Regressão local</h2>
<p>O estimador mais adequado e comum para RDD é o que usa apenas observações próximas da descontinuidade, isto é, que usa apenas observações em uma janela em torno de <span class="math inline">\(c\)</span>. O quão próximas as observações precisam ser? Digamos que, no nosso exemplo, uma janela <span class="math inline">\(c=0.2\)</span> seja adequada. O código para estimar esse modelo é:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o modelo</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>dados_janela <span class="ot">&lt;-</span> dados <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;</span> <span class="fl">0.2</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>local <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">+</span> d <span class="sc">+</span> x<span class="sc">*</span>d, <span class="at">data =</span> dados_janela)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultados</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">etable</span>(rigido, flexivel, local, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           rigido        flexivel           local
Dependent Var.:                 y               y               y
                                                                 
Constant         -0.443** (0.134)  -0.242 (0.171)  -0.394 (0.394)
x               -0.512*** (0.112)  -0.255 (0.176)    -2.61 (3.45)
d                 2.19*** (0.231) 2.13*** (0.232) 2.30*** (0.610)
x x d                             -0.428. (0.227)     2.67 (5.15)
_______________ _________________ _______________ _______________
S.E. type                     IID             IID             IID
Observations                  200             200              39
R2                        0.36055         0.37193         0.61592
Adj. R2                   0.35405         0.36232         0.58299
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>O resultado do modelo flexível é nitidamente enviesado. Como?</p>
</section>
<section id="janela" class="level2">
<h2 class="anchored" data-anchor-id="janela">Janela</h2>
<p>Como dá para perceber, a escolha da janela tem consequências e, no mais das vezes, pesquisas aplicadas testam vários deles (justamente porque seu uso incorreto pode gerar viés, como no caso anterior). Se plotarmos os dados anteriores, veremos que, nesse caso, o viés decorre da falta de observações:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plota os dados</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dados_janela <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">as.factor</span>(d), <span class="at">group =</span> d)) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#EF2D56"</span>, <span class="st">"#363537"</span>)) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Tratamento (D)"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico5_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Um exercício é usar diferentes intervalos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o modelo</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">+</span> d <span class="sc">+</span> x<span class="sc">*</span>d, <span class="at">data =</span> dados <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;</span> <span class="dv">1</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">+</span> d <span class="sc">+</span> x<span class="sc">*</span>d, <span class="at">data =</span> dados <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;</span> <span class="fl">0.75</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">+</span> d <span class="sc">+</span> x<span class="sc">*</span>d, <span class="at">data =</span> dados <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;</span> <span class="fl">0.5</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">+</span> d <span class="sc">+</span> x<span class="sc">*</span>d, <span class="at">data =</span> dados <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;</span> <span class="fl">0.2</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultados</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">etable</span>(mod1, mod2, mod3, mod4, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           mod1            mod2            mod3            mod4
Dependent Var.:               y               y               y               y
                                                                               
Constant         -0.289 (0.211)  -0.195 (0.241)  -0.235 (0.310)  -0.394 (0.394)
x                -0.429 (0.419)  -0.067 (0.613)   -0.348 (1.33)    -2.61 (3.45)
d               2.23*** (0.296) 2.14*** (0.351) 2.14*** (0.442) 2.30*** (0.610)
x x d            -0.341 (0.600)  -0.738 (0.956)   -0.229 (1.77)     2.67 (5.15)
_______________ _______________ _______________ _______________ _______________
S.E. type                   IID             IID             IID             IID
Observations                128             105              81              39
R2                      0.47660         0.49073         0.48744         0.61592
Adj. R2                 0.46393         0.47561         0.46747         0.58299
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="rdrobust" class="level2">
<h2 class="anchored" data-anchor-id="rdrobust"><code>rdrobust</code></h2>
<p>Na prática, acertar escolha de janela, especificação, entre outros detalhes, não é algo simples. Por essa razão, o padrão corrente na literatura é usar o estimador proposto por <span class="citation" data-cites="calonico2015rdrobust">Calonico, Cattaneo, e Titiunik (<a href="#ref-calonico2015rdrobust" role="doc-biblioref">2015</a>)</span>, disponível no pacote <code>rdrobust</code>, que usa um algoritmo para selecionar janela automaticamente (balanceando viés e precisão); corrige erros-padrão; e permite usar polinômios para flexibilizar a relação entre <span class="math inline">\(Y\)</span> e <span class="math inline">\(X\)</span>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Podemos aplicá-lo nos dados que geramos (lembrando, <span class="math inline">\(\tau=2\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima o modelo</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(dados<span class="sc">$</span>y, dados<span class="sc">$</span>x)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resultados)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sharp RD estimates using local polynomial regression.

Number of Obs.                  200
BW type                       mserd
Kernel                   Triangular
VCE method                       NN

Number of Obs.                   99          101
Eff. Number of Obs.              50           52
Order est. (p)                    1            1
Order bias  (q)                   2            2
BW est. (h)                   0.699        0.699
BW bias (b)                   1.162        1.162
rho (h/b)                     0.602        0.602
Unique Obs.                      99          101

=============================================================================
        Method     Coef. Std. Err.         z     P&gt;|z|      [ 95% C.I. ]       
=============================================================================
  Conventional     2.175     0.379     5.738     0.000     [1.432 , 2.918]     
        Robust         -         -     4.718     0.000     [1.261 , 3.053]     
=============================================================================</code></pre>
</div>
</div>
<p>E produzir um gráfico com uma única linha de código:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdplot</span>(dados<span class="sc">$</span>y, dados<span class="sc">$</span>x)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="topico5_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Com os dados de <span class="citation" data-cites="lee2008randomized">Lee (<a href="#ref-lee2008randomized" role="doc-biblioref">2008</a>)</span>, estimamos o efeito local também usando:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplica o estimador</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(Lee2008<span class="sc">$</span>y, Lee2008<span class="sc">$</span>x)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rdrobust(Lee2008$y, Lee2008$x): Mass points detected in the running
variable.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resultados)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sharp RD estimates using local polynomial regression.

Number of Obs.                 6558
BW type                       mserd
Kernel                   Triangular
VCE method                       NN

Number of Obs.                 2740         3818
Eff. Number of Obs.             789          817
Order est. (p)                    1            1
Order bias  (q)                   2            2
BW est. (h)                   0.136        0.136
BW bias (b)                   0.240        0.240
rho (h/b)                     0.565        0.565
Unique Obs.                    2108         2581

=============================================================================
        Method     Coef. Std. Err.         z     P&gt;|z|      [ 95% C.I. ]       
=============================================================================
  Conventional     0.064     0.011     5.815     0.000     [0.042 , 0.085]     
        Robust         -         -     4.738     0.000     [0.035 , 0.084]     
=============================================================================</code></pre>
</div>
</div>
</section>
<section id="especificação-e-exportação" class="level2">
<h2 class="anchored" data-anchor-id="especificação-e-exportação">Especificação e exportação</h2>
<p>Por padrão, a função <code>rdrobust</code> estima modelos de regressão locais com polinômio de ordem 1, usando como <em>cutoff</em> 0, entre outros. Assim como em outras funções usadas para estimar modelos, no entanto, podemos mudar várias coisas nela: a ordem do polinômio usado (argumento <code>p =</code>); valor do <em>cutoff</em> (argumento <code>c =</code>); e a janela usada (argumento <code>h =</code>).</p>
<p>Usando os dados de <span class="citation" data-cites="lee2008randomized">Lee (<a href="#ref-lee2008randomized" role="doc-biblioref">2008</a>)</span>, podemos, por exemplo, estimar diferentes modelos RDD que variam o polinômio usado, de 1 a 3:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima os modelos</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(Lee2008<span class="sc">$</span>y, Lee2008<span class="sc">$</span>x, <span class="at">p =</span> <span class="dv">1</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(Lee2008<span class="sc">$</span>y, Lee2008<span class="sc">$</span>x, <span class="at">p =</span> <span class="dv">2</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(Lee2008<span class="sc">$</span>y, Lee2008<span class="sc">$</span>x, <span class="at">p =</span> <span class="dv">3</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"Polinômio 1"</span> <span class="ot">=</span> mod1,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Polinômio 2"</span> <span class="ot">=</span> mod2,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Polinômio 3"</span> <span class="ot">=</span> mod3)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(modelos, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">coef_map =</span> <span class="fu">list</span>(<span class="st">"Robust"</span> <span class="ot">=</span> <span class="st">"LATE"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Polinômio 1</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;Polinômio 2</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;Polinômio 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LATE</td>
<td style="text-align: center;">0.059</td>
<td style="text-align: center;">0.063</td>
<td style="text-align: center;">0.055</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.013)</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.012)</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.015)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Janela</td>
<td style="text-align: center;">0.1</td>
<td style="text-align: center;">0.3</td>
<td style="text-align: center;">0.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">N</td>
<td style="text-align: center;">1606</td>
<td style="text-align: center;">3161</td>
<td style="text-align: center;">3484</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Útil saber: usamos a função <code>modelsummary</code> para exportar uma tabela com os resultados dos três modelos, que foram passados para a lista <code>modelos</code> acompanhada dos nomes de cada um.</p>
<p>E se quisermos mudar a janela usada, isto é, a distância aceitável entre pontos e a descontinuidade? Fácil: é só mudar <code>h</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima os modelos</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(Lee2008<span class="sc">$</span>y, Lee2008<span class="sc">$</span>x, <span class="at">h =</span> <span class="fl">0.01</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(Lee2008<span class="sc">$</span>y, Lee2008<span class="sc">$</span>x, <span class="at">h =</span> <span class="fl">0.05</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(Lee2008<span class="sc">$</span>y, Lee2008<span class="sc">$</span>x, <span class="at">h =</span> <span class="fl">0.1</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"Janela 0.01"</span> <span class="ot">=</span> mod1,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Janela 0.05"</span> <span class="ot">=</span> mod2,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Janela 0.1"</span> <span class="ot">=</span> mod3)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(modelos, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">coef_map =</span> <span class="fu">list</span>(<span class="st">"Robust"</span> <span class="ot">=</span> <span class="st">"LATE"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Janela 0.01</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;Janela 0.05</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Janela 0.1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LATE</td>
<td style="text-align: center;">0.086</td>
<td style="text-align: center;">0.105</td>
<td style="text-align: center;">0.064</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.047)</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.023)</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.016)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Janela</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">N</td>
<td style="text-align: center;">104</td>
<td style="text-align: center;">610</td>
<td style="text-align: center;">1208</td>
</tr>
</tbody>
</table>


</div>
</div>
<section id="tabelas-com-modelos-diferentes" class="level3">
<h3 class="anchored" data-anchor-id="tabelas-com-modelos-diferentes">Tabelas com modelos diferentes</h3>
<p>Para o caso em que cada modelo tiver uma variável dependente diferente, podemos mostrar resultados de uma forma ligeiramente diferente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(modelos, <span class="at">digits =</span> <span class="dv">2</span>, </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">shape =</span> model <span class="sc">~</span> term <span class="sc">+</span> statistic,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">coef_map =</span> <span class="fu">list</span>(<span class="st">"Robust"</span> <span class="ot">=</span> <span class="st">"LATE"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
LATE
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Est.</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">S.E.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Janela 0.01</td>
<td style="text-align: center;">0.086</td>
<td style="text-align: center;">0.047</td>
</tr>
<tr class="even">
<td style="text-align: left;">Janela 0.05</td>
<td style="text-align: center;">0.105</td>
<td style="text-align: center;">0.023</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Janela 0.1</td>
<td style="text-align: center;">0.064</td>
<td style="text-align: center;">0.016</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Aqui, <code>shape = model ~ term + statistic</code> diz para a função <code>modelsummary</code> que queremos colocar os diferentes modelos nas linhas e, nas colunas, os coeficientes e estatísticas.</p>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Referências</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-calonico2015rdrobust" class="csl-entry" role="listitem">
Calonico, Sebastian, Matias D Cattaneo, e Rocio Titiunik. 2015. <span>«Rdrobust: an R package for robust nonparametric inference in regression-discontinuity designs.»</span> <em>R J.</em> 7 (1): 38.
</div>
<div id="ref-lee2008randomized" class="csl-entry" role="listitem">
Lee, David S. 2008. <span>«Randomized experiments from non-random selection in US House elections»</span>. <em>Journal of Econometrics</em> 142 (2): 675–97.
</div>
<div id="ref-skovron2015practical" class="csl-entry" role="listitem">
Skovron, Christopher, e Rocıo Titiunik. 2015. <span>«A practical guide to regression discontinuity designs in political science»</span>. <em>American Journal of Political Science</em> 2015: 1–36.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notas de rodapé</h2>

<ol>
<li id="fn1"><p>No futuro, talvez eu inclua mais funcionalidades nesse pacote, mas, por enquanto, ele só serve para isso mesmo.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Há outras formas de simular um RDD, e em PGDs do mundo real não há garantias de que a relação entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> é não-linear, ou que o efeito do tratamento, <span class="math inline">\(D\)</span>, não varie com <span class="math inline">\(X\)</span>, isto é, <span class="math inline">\(D | X\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>O estimador é mais complexo do que isso e, na realidade, faz outras coisas, como aplicar pesos diferentes a determinadas observações, o que é chamado de <em>kernel</em>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>