<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Usando R - 4&nbsp; Visualização</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05-cap.html" rel="next">
<link href="./03-cap.html" rel="prev">
<link href="./icon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>


<meta name="twitter:title" content="Usando R - 4&nbsp; Visualização">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://electionsbr.com/livro/04-cap_files/figure-html/unnamed-chunk-4-1.png">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1344">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-cap.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualização</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Usando R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="./Usando-R.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo de leitor">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-cap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Básico</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-cap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Importação</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-cap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Manipulação</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-cap.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualização</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-cap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Análise</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./referencias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#por-que-usar-visualizações" id="toc-por-que-usar-visualizações" class="nav-link active" data-scroll-target="#por-que-usar-visualizações"><span class="header-section-number">4.1</span> Por que usar visualizações?</a></li>
  <li><a href="#fundamentos-do-ggplot2" id="toc-fundamentos-do-ggplot2" class="nav-link" data-scroll-target="#fundamentos-do-ggplot2"><span class="header-section-number">4.2</span> Fundamentos do <code>ggplot2</code></a></li>
  <li><a href="#resumo" id="toc-resumo" class="nav-link" data-scroll-target="#resumo"><span class="header-section-number">4.3</span> Resumo</a></li>
  <li><a href="#indo-além" id="toc-indo-além" class="nav-link" data-scroll-target="#indo-além"><span class="header-section-number">4.4</span> Indo além</a></li>
  <li><a href="#exercício" id="toc-exercício" class="nav-link" data-scroll-target="#exercício"><span class="header-section-number">4.5</span> Exercício</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-cap4" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualização</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Parte importante do trabalho de análise é a visualização dos nossos dados. Ela pode ser utilizada não só para resumir resultados de pesquisa como, também, para fazer análise exploratória e descobrir padrões. Nesse capítulo, veremos justamente como usar R gerar visualizações que nos ajudem a explorar dados, documentar e exportar resultados de análises.</p>
<p>É possivel gerar visualizações apenas usando R-base, isto é, funcionalidade que já estão disponíveis por padrão no R. No entanto, seguindo que já fizemos em outros capítulos, aqui também adotaremos o <code>tidyverse</code>, particularmente o seu pacote <code>ggplot2</code>, desenvolvido por <span class="citation" data-cites="wickham2016ggplot2">Wickham (<a href="referencias.html#ref-wickham2016ggplot2" role="doc-biblioref">2016</a>)</span> a partir da gramática de grafícos de <span class="citation" data-cites="wilkinson2012grammar">Wilkinson (<a href="referencias.html#ref-wilkinson2012grammar" role="doc-biblioref">2012</a>)</span>. A ideia por detrás dessa gramática, adotada pelo <code>ggplot2</code>, é a de que todo gráfico pode ser decomposto em camadas, cada uma delas representando um elemento do gráfico. Abordaremos este tema no capítulo, ainda que brevemente, para facilitar a compreensão da lógica de funcionamento do <code>ggplot2</code> – pacote que revolucionou o modo de produzir gráficos usando a linguagem R.</p>
<p>Para poder executar os códigos deste capítulo, você precisará carregar o <code>tidyverse</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="por-que-usar-visualizações" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="por-que-usar-visualizações"><span class="header-section-number">4.1</span> Por que usar visualizações?</h2>
<p>Dados podem ser apresentados em uma tabela, seja com valores brutos ou resumidos em alguma métrica, como veremos no próximo capítulo. No entanto, como argumentam <span class="citation" data-cites="kastellec2007using">Kastellec e Leoni (<a href="referencias.html#ref-kastellec2007using" role="doc-biblioref">2007</a>)</span>, em geral a análise gráfica é mais intuitiva. Compare, por exemplo, a tabela a seguir, que mostra dois indicadores fictícios que variam ao longo dos anos de 2010 a 2024, com a sua versão gráfica, ao lado:</p>
<p>Quando bem feito, um gráfico é capaz mostrar dados de forma <em>precisa</em>, <em>nítida</em> e <em>eficiente</em> <span class="citation" data-cites="tufte1983visual">Healy (<a href="referencias.html#ref-healy2018data" role="doc-biblioref">2018</a>)</span>. Ele passa a sua mensagem, ou a sua história, sem a necessidade ou o auxílio de um texto.</p>
<p>Para que tenhamos esse visual gráfico claro, preciso e eficiente, vale levar em conta algumas observações de <span class="citation" data-cites="tufte1983visual">Tufte (<a href="referencias.html#ref-tufte1983visual" role="doc-biblioref">1983</a>)</span>. Para ele, bons gráficos colocam os dados acima de tudo, ou seja, todo e qualquer artifício de <em>design</em> só deve ser feito exclusivamente para ajudar deixar os dados mais nítidos, e não mais obtusos. A ideia de fundo é que devemos nos concentrar na substância dos dados, e não em qualquer outro elemento, como metodologia ou tecnologia utilizada na produção do gráfico.</p>
<p>Outro ponto importante é que uma boa visualização consegue levar aos olhos comparações de diferentes pedaços de dados disponibilizados – sem, contudo, gerar distorções desses dados, levando em consideração o propósito geral da análise, seja ela exploração ou descrição. Tudo isso considerado, usar visualizações é uma forma de comunicar resultados de forma global, com economia de espaço e sem, se bem feita, sem perda de precisão.</p>
</section>
<section id="fundamentos-do-ggplot2" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="fundamentos-do-ggplot2"><span class="header-section-number">4.2</span> Fundamentos do <code>ggplot2</code></h2>
<p>De longe o pacote mais utilizado para produzir visualizações em R, o <code>ggplot2</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> é baseado na gramática de gráficos, que é uma forma de descrever visualizações por meio de camadas. A ideia é que cada camada representa um elemento do gráfico: os dados usados para produzir formas e determinar escalas dos eixos, geometria, coordenadas, facetas e temas. Essa lógica separa, portanto, diferentes partes da produção de um gráfico, o que abre um universo de possibilidades de combinações entre essas camadas.</p>
<p>O que precisamos para fazer um gráfico no ggplot2? Basicamente, penas determinar quais são os nosso dados e a geometria que vamos usar. Para dar um exemplo inicial, usaremos dados de uma das mais tradicionais pesquisas de opinião do Brasil, o Estudo Eleitoral Brasileiro (ESEB), que é realizada periodicamente após eleições nacionais pelo <a href="https://www.cesop.unicamp.br/">Centro de Estudos de Opinião Pública (CESOP)</a>, da Universidade Estadual de Campinas (UNICAMP).<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> A base de dados que usaremos é a do ESEB 2022, disponível no formato SPSS no arquivo <code>eseb2022.sav</code> na pasta de materiais complementares deste livro. Para carregar o arquivo, podemos usar a função <code>read_sav</code> do pacote <code>haven</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregando pacotes</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregando dados</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"eseb_2022/eseb2022.sav"</span>, <span class="at">encoding =</span> <span class="st">"latin1"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se inspecionarmos a base (com <code>View(dados)</code>), veremos que os <em>labels</em> das variáveis não estão disponíveis. Isso acontece porque a função <code>read_sav</code> carrega apenas os códigos das categorias das variáveis, e não os <em>labels</em> que as descrevem, como vimos no <a href="02-cap.html"><span>Capítulo&nbsp;2</span></a>. Para usar os <em>labels</em>, podemos usar a função <code>as_factor</code>, também do pacote <code>haven</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(dados)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com os dados carregados e com <em>labels</em> atribuídos, podemos fazer o seguinte gráfico usando o ggplot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Um grafico com ggplot</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>No código anterior, utilizamos a variável <code>D01a_FX_ID</code>, que indica a faixa de idade do entrevistado. Na sequência com auxilio do “+” agregamos uma camada de geometria que no caso foi a barra. Perceba que a função ggplot mapeou a base de dados e entendeu que todas variáveis dela agora faz parte do “ambiente” ggplot assim podemos usá-las sem indexar ao objeto <em>dados</em> (dados$D01A_FX_ID). Esse mapeamento já identificou os eixos que nesse caso só foi informado o eixo X na estética (Aesthetic - função <em>aes</em>).</p>
<p>Por sua vez, a camada geometria <em>geom_bar</em> por padrão faz uma contagem dos itens dentro da variável informada, que nesse caso é a faixa de idade, então ela vai fazer a contagem de quantos entrevistados tem em cada faixa. Ou seja, para fazer um gráfico de barras com a contagem de algo podemos informar os dados bruto, sem precisar fazer uma tabela de frequência previamente.</p>
<p>Podemos melhora a capacidade de informar desse gráfico, para isso Temos 5 elementos que consititui a lógica de fazer gráficos no R com ggplot, ou melhor a gramática de gráficos, já usamos dois primeiros, são eles:</p>
<ol type="1">
<li>Dados - Conjutos de informações que deseja visualizar e as variáveis que serão mapeados para os atributos estéticos;</li>
<li>Geometria - Camadas que contém elementos geoméricos e transformações estatísticas, no ggplot e extensões para ggplot as funções começam com prefixo “geom_”;</li>
<li>Escalas - Refere-se aos valores em um espaço, mas também a cor, tamanho ou forma de atributos do gráfico, além de eixos e legendas. Começam com prefixo “scale_”;</li>
<li>Coordenadas - O sistema de coordenadas utilizada no plano, por padrão coordenada cartesiana, xy. Estão disponíveis também outros sistemas de coordenadas como polar e projeção de mapas. Começam com prefixo “coord_”;</li>
<li>Faceta - Para fazer gráficos em subgrupos do mesmo conjunto de dados. Começão com prefixo “facet_”;</li>
<li>Temas - Controla questões de exibição, como tamanho da fonte cor do plano de fundo, rotação de texto nos eixos, grade, entre outros. Há uma função genérica chama “theme” e o prefixo para temas diversos é “theme_”.</li>
</ol>
<p>Dito isto, vamos editar nosso gráfico.</p>
<p>Podemos usar uma camada scale_ para exbir os valores (códigos) de todas as faixas de idade. Por exemplo scale_x_contiunous que serve para editar a escala do eixo x quando ele é continuo, no caso varia 1 a 7.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos usar essa informação para editar nosso gráfico. Para isso dentro do aes vamos transformar nossa variável de interesse em texto, e no lugar de usar uma escala continua vamos usar uma escala discreta para alterar os valores do eixo x.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(<span class="fu">as.character</span>(D01A_FX_ID))) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"65+"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para altera nomes dos eixos, títulos e subtítulos, por exemplo, podemos usar a função <strong>labs</strong> em mais uma camada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(<span class="fu">as.character</span>(D01A_FX_ID))) <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entrevistados por faixa de idade"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB - 2022"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Essa grade por trás das barras não traz nenhuma informação relevante para esse gráfico, assim como a cor de fundo. Então podemos retirar esses elementos deixando o gráfico mais limpo em termos de informação desnecessaria, para isso podemos aplicar um tema diferente do padrão do ggplot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(<span class="fu">as.character</span>(D01A_FX_ID))) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entrevistados por faixa de idade"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB - 2022"</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dependendo do uso que vamos fazer, é preferivél ter os valores da quantidade de entrevistados direto em cada barra, assim, podemos aplicar mais uma camada com a função <strong>geom_text</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(<span class="fu">as.character</span>(D01A_FX_ID))) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entrevistados por faixa de idade"</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB - 2022"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="fu">aes</span>(<span class="at">label =</span> ..count..), </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com estamos usando os micro-dados e toda operação aritmética está sendo feita dentro do ambiente do ggplot, é necessário informa na função <em>geom_text</em> qual é a estatística que está sendo feita que nesse caso é contagem (o padrão da função <em>geom_bar</em>). Nesse caso a estética é o valor dessa contagem que é recuperado pelo operador “..count..”, foi também adcionado um ajustamento vertical, que quando é possitivo os valores são plotados mais próximo do eixo x e negativo mais longe do eixo de referência (vjust eixo x, hjust eixo y).</p>
<p>Suponha que em seu projeto de visualização de dados as informações do eixo y sejam desnecessária uma vez que já está direto acima da barra. Podemos usar nossa função genérica <strong>theme</strong> para fazer essa edição. Como ja estamos usando um tema, a camada com a função genérica vai logo após o tema em uso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(<span class="fu">as.character</span>(D01A_FX_ID))) <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Número de entrevistados por faixa de idade"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB - 2022"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="fu">aes</span>(<span class="at">label =</span> ..count..), </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Observem que mesmo mantendo na função <em>labs</em> y = “N”, esse elemento não fica no gráfico porque foi subtituído na função <em>theme</em> por um elemento em branco - <em>element_blanc</em> no argumento <em>axis.title.y</em>. Bem, todos elementos de exibição do gráfico pode ser controlado por essa função <em>theme</em>, inclusive pode ser usada para você criar o próprio tema.</p>
<p>Vamos agora fazer um novo gráfico com a mesma geometria (barra), sendo que com os dados já agregado em algum nível. Para isso vamos usar os dados do tamanho da população do Brasil por Estado, a partir da parcial do censo 2022<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"data/POP2022_Brasil.csv"</span>, <span class="at">fileEncoding =</span> <span class="st">"latin1"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(<span class="fu">reorder</span>(Unidades_Federacao, POPULACAO), POPULACAO)) <span class="sc">+</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"População Brasileira por Estado"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Censo - 2022 (IBGE)"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Repetimos basicamente o mesmo código do gráfico com os dados do ESEB. As principais alterações foram: 1) no aes, foi incluir um valor para y (POPULACAO), e 2) na geometria (geom_bar) incluir o argumento stat igual a “identity”, que informa que não é necessário fazer qualquer transformação no dado, ele vai ser usado do jeito que veio.</p>
<p>No mais, algumas alterações foram feitas para melhorar a visualização: 1) no elemento x foi incluído uma função reorder que reodena os valores de x a partir de um valor qualquer, no caso escolhemos o próprio valor da população contido na variável “POPULACAO”; 2) como os labels das unidade da federação são relativamente grandes usamos a função coor_flip para que os labels que iam aparacer orginalmente no eixo x, seja exibido no eixo y, o mesmo com o eixo y, ou seja, uma mudança nos eixos.</p>
<p>Observe que na nossa função genérica de gráfico excluimos os dois argumento refentes a ticks (traços) e texto do eixo y, com isso o gráfico voltou a exibir o rótulo de cada coluna (unidade da federação) e os respectivos traços.</p>
<p>Além do gráfico de barras que exploramos o ggplot tem outros tipos de gráficos (geometrias) nativos, que já vem inclusa quando instalamos o pacote, tais como: linhas - <em>geom_line</em>, barra de erro - <em>geom_errobar</em>, disperção - <em>geom_point</em>, histograma - <em>geom_histogram</em> entre outras.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
GGPLOT - Extensões
</div>
</div>
<div class="callout-body-container callout-body">
<p>Além das geometria nativas você pode adicionar outras geometrias e temas, por exemplo. Para isso você pode criar suas próprias extensões ou instalar a que outros desenvolvedores fizeram. Para instalar você pode procurar pacotes. O tidyverse organiza e disponiliza informações para coleção bastatante rica: https://exts.ggplot2.tidyverse.org/gallery/<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. Que tem por exemplo o <strong>gganimate</strong> para fazer gráficos animanos em gif, ou o <strong>ggdag</strong> para desenhar relações clausais, ou o ggpol para plotar seus em formato de parlamentos.</p>
</div>
</div>
<p>Vamos usar os dados anteriores para criar um mapa, onde cada estado será colorido pela quantidade da populacação identificada pelo IBGE. Mas para isso vamos precisar ter um objeto com as informações geográficas (geolocalização) dos estados. Temos na nossa pasta <em>data</em> tem um arquivo que tem essas informações, o <em>shp_uf_brasil.Rds</em>. Mas você poderia para o caso brasileiro usar o pacote <strong>geobr</strong>. De todo modo se você quiser trabalhar com outras geolocalização basta procurar um pacote específico, e se não tiver, procurar o <em>shapesfile (shp)</em> da região que você precisa.</p>
<p>Para criar o nosso mapa vamos unir (fazer um merge) as informações geográficas do objeto <strong>estado</strong> com as informações do censo do objeto <strong>dados</strong>. Depois vamos usar a geometria <em>geom_sf</em> para criar o mapa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>estados <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/shp_uf_brasil.Rds"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>estados <span class="ot">&lt;-</span> <span class="fu">merge</span>(estados, dados,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by.x =</span> <span class="st">"name_state"</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by.y =</span> <span class="st">"Unidades_Federacao"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(estados) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> POPULACAO)) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#56B1F7"</span>, <span class="at">high =</span>  <span class="st">"#132B43"</span>) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Com essa geometria <em>geom_sf</em> não precisamos atribuir um x ou um y na <em>aes</em>, pois, x e y serão as coordenadas geográficas contidas na variável “geometry” do nosso objeto <strong>estados</strong> que é da class <em>sf</em>. Então atribuímos apenas um <em>fill</em> para colorir os estados, neste caso, em uma escala continua porque a váriavel população é continua. Se fosse uma variável categórica o ggplot compreenderia que a escala de cores seria discreta, uma cor para cada categoria.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Erros
</div>
</div>
<div class="callout-body-container callout-body">
<p>Se eventualmente ocorrer um erro referente a função geom_sf - <strong>error in <code>compute_layer()</code></strong>, ou similar. Carregue o pacote “sf” - library(sf), considerando que já está instalado, se não instale primeiro. Pois, esse é o pacote que originalmente criou a geometria <em>geom_sf</em> e outras funções para trabalhar com dados geolocalizados.</p>
</div>
</div>
</section>
<section id="resumo" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="resumo"><span class="header-section-number">4.3</span> Resumo</h2>
<p>Neste capítulos estudamos os principais conceitos para produção de gráfico no R a partir do pacote ggplot. Usando micro dados e dados já sumarizado para compreendermos como funcionao o ambiente ggplot e o processo de adição de camadas para criarmos o nosso projeto gráfico. É fato que não exaurimos todas as possibilidades mas seguimos uma trilha que abre novos caminhos possbilidades para executar a tarefa de produzir vizualizações com mais eficiência e agilidade.</p>
</section>
<section id="indo-além" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="indo-além"><span class="header-section-number">4.4</span> Indo além</h2>
<p>Produzir uma vizualização que atenda necessidades acadêmicas ou de mercado devemos considerar além da geometria adequada, devemos considerar como vamos colorir nossos gráficos. Embora, em trabalhos acadêmico seja majoritário o uso de preto ou escala de cinza, háverar momentos que vamos precisar de usar uma paleta de cores de diferentes, o ggplot ja tem algumas paletas elaboradas para isso, considerando escalas de divergência, sequência e qualidade (RColorBrewer). Recomandamos você buscar aprender mais sobre isso, pois, uma escolha errada pode deixar o gráfico ilegível para pessoas com daltonismo, por exemplo.</p>
</section>
<section id="exercício" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="exercício"><span class="header-section-number">4.5</span> Exercício</h2>
<p>1 - Quais dos elementos abaixo são imprecindiveis para gerar um gráfico?</p>
<ol type="a">
<li>dados</li>
<li>geometria</li>
<li>tema</li>
<li>dados e geometria</li>
<li>dados e tema</li>
</ol>
<p>2 - A coordenada polar é o principal sistema e coordenadas do ggplot, sendo usado por padrão. Essa assertiva é:</p>
<ol type="a">
<li>Verdadera ()</li>
<li>falsa ()</li>
</ol>
<ol start="3" type="1">
<li><p>Carregue arquivo <code>populacao_brasil.xls</code> e criar um gráfico de linhas, onde o eixo x será os anos e eixo y a população brasileira, considere deixar o gráfico mais informativo possível com mínimo de elementos designer possível.</p></li>
<li><p>Na função ggplor dois elementos da gramtática de gráficos são fundamentais, quais são?</p></li>
</ol>
<ol type="a">
<li>dados</li>
<li>estética (aesthetics)</li>
<li>facet</li>
<li>dados e color</li>
<li>dados e estética</li>
</ol>
<ol start="5" type="1">
<li>Após definimos os argumentos da função ggplot, que elemento da gramática de gráficos fica faltando para gerar o gráfico?</li>
</ol>
<ol type="a">
<li>facet</li>
<li>theme</li>
<li>geom</li>
<li>scale</li>
<li>coord</li>
</ol>
<ol start="6" type="1">
<li>Para construir um gráfico usando o ggplot, o fazemos por camadas, qual operador usamos para adcionar cada camada?</li>
</ol>
<ol type="a">
<li>%&gt;%</li>
<li>%&lt;&gt;%</li>
<li>&lt;-</li>
<li>=</li>
<li><ul>
<li></li>
</ul></li>
</ol>
<ol start="7" type="1">
<li>Quando utilizamos a geometria de barras (geom_bar) o argumento <em>stat</em> igual a ‘identity’ é obrigatório quando estamos utilizando micro-dados no ambiente ggplot. A assertiva é:</li>
</ol>
<ol type="a">
<li>verdadeira ()</li>
<li>falsa ()</li>
</ol>
<ol start="8" type="1">
<li>Considere o arquivo sobre gastos e votos para governadores <code>governador_18_22.Rds</code>, e a partir dele queremos criar um gráfico que relacione estas duas variáveis por eleição, qual seria a melhor apresentação?</li>
</ol>
<ol type="a">
<li>x = % gastos, y = % votos + geom_bar</li>
<li>x = % gastos, y = % votos + gem_line</li>
<li>x = % gastos, y = % votos + geom_point</li>
<li>x = % gastos, y = % votos, color = ano_eleicao + geom_point</li>
<li>x = % gastos, y = % votos + geom_point + facet = ano_eleicao</li>
</ol>
<p>9 - O tema void <code>theme_void</code> é um tema praticamente vazio que só preseva a a geometria e linhas horizontais (grid). A assertiva é:</p>
<ol type="a">
<li>verdadeira ()</li>
<li>falsa</li>
</ol>
<p>10 - para editar temas podemos usara função genérica <code>theme</code>. Quando usamos o argumento <code>axis.text.x</code> podemos alterar:</p>
<ol type="a">
<li>os rótulos dos valores do eixo x</li>
<li>o título do eixo x</li>
<li>os rótulos e título do eixo x</li>
<li>marcas de escala no eixo x</li>
<li>o título no eixo y</li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-healy2018data" class="csl-entry" role="listitem">
Healy, Kieran. 2018. <em>Data visualization: a practical introduction</em>. Princeton University Press.
</div>
<div id="ref-kastellec2007using" class="csl-entry" role="listitem">
Kastellec, Jonathan P, e Eduardo L Leoni. 2007. <span>«Using graphs instead of tables in political science»</span>. <em>Perspectives on politics</em> 5 (4): 755–71.
</div>
<div id="ref-tufte1983visual" class="csl-entry" role="listitem">
Tufte, Edward R. 1983. <span>«The visual display of»</span>. <em>Quantitative Information</em>, 13.
</div>
<div id="ref-wickham2016ggplot2" class="csl-entry" role="listitem">
Wickham, Hadley. 2016. <em>ggplot2: Elegant Graphics for Data Analysis</em>. Springer.
</div>
<div id="ref-wilkinson2012grammar" class="csl-entry" role="listitem">
Wilkinson, Leland. 2012. <em>The grammar of graphics</em>. Springer.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Normalmente mencionamos <code>ggplot</code> quando estamos falando do pacote <code>ggplot2</code>, utilizado para produzir gráficos.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>O ESEB é conduzido desde 2002 e é vinculado ao <em>Comparative Study of Electoral Systems Project (CSES)</em>, projeto global de pesquisas pós-eleitorais. Para saber mais sobre o ESEB, ver <a href="https://www.cesop.unicamp.br/por/eseb">https://www.cesop.unicamp.br/por/eseb</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Lançada pelo IBGE em junho de 2023<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>https://exts.ggplot2.tidyverse.org/gallery/<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03-cap.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Manipulação</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05-cap.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Análise</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Usando R, por Fernando Meireles e Denisson Silva</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>