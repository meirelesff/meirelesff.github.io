<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Usando R - 4&nbsp; Visualização</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05-cap.html" rel="next">
<link href="./03-cap.html" rel="prev">
<link href="./icon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<meta name="twitter:title" content="Usando R - 4&nbsp; Visualização">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://electionsbr.com/livro/04-cap_files/figure-html/fig-indicadores-1.png">
<meta name="twitter:image-height" content="1516">
<meta name="twitter:image-width" content="1344">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-cap.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualização</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Usando R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="./Usando-R.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo de leitor">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-cap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Básico</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-cap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Importação</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-cap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Manipulação</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-cap.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualização</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-cap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Análise</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./referencias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#por-que-usar-visualizações" id="toc-por-que-usar-visualizações" class="nav-link active" data-scroll-target="#por-que-usar-visualizações"><span class="header-section-number">4.1</span> Por que usar visualizações?</a></li>
  <li><a href="#fundamentos-do-ggplot2" id="toc-fundamentos-do-ggplot2" class="nav-link" data-scroll-target="#fundamentos-do-ggplot2"><span class="header-section-number">4.2</span> Fundamentos do <code>ggplot2</code></a></li>
  <li><a href="#camadas-de-uma-visualização" id="toc-camadas-de-uma-visualização" class="nav-link" data-scroll-target="#camadas-de-uma-visualização"><span class="header-section-number">4.3</span> Camadas de uma visualização</a>
  <ul class="collapse">
  <li><a href="#geometrias" id="toc-geometrias" class="nav-link" data-scroll-target="#geometrias"><span class="header-section-number">4.3.1</span> Geometrias</a></li>
  <li><a href="#escalas" id="toc-escalas" class="nav-link" data-scroll-target="#escalas"><span class="header-section-number">4.3.2</span> Escalas</a></li>
  <li><a href="#coordenadas" id="toc-coordenadas" class="nav-link" data-scroll-target="#coordenadas"><span class="header-section-number">4.3.3</span> Coordenadas</a></li>
  <li><a href="#facetas" id="toc-facetas" class="nav-link" data-scroll-target="#facetas"><span class="header-section-number">4.3.4</span> Facetas</a></li>
  <li><a href="#temas" id="toc-temas" class="nav-link" data-scroll-target="#temas"><span class="header-section-number">4.3.5</span> Temas</a></li>
  </ul></li>
  <li><a href="#resumo" id="toc-resumo" class="nav-link" data-scroll-target="#resumo"><span class="header-section-number">4.4</span> Resumo</a></li>
  <li><a href="#exercícios" id="toc-exercícios" class="nav-link" data-scroll-target="#exercícios">Exercícios</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-cap4" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualização</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Parte importante do trabalho de análise é a visualização dos nossos dados. Ela pode ser utilizada não só para resumir resultados de pesquisa como, também, para fazer análise exploratória e descobrir padrões. Nesse capítulo, veremos justamente como usar R gerar visualizações que nos ajudem a explorar dados, documentar e exportar resultados de análises.</p>
<p>É possivel gerar visualizações apenas usando R-base, isto é, funcionalidade que já estão disponíveis por padrão no R. No entanto, seguindo que já fizemos em outros capítulos, aqui também adotaremos o <code>tidyverse</code>, particularmente o seu pacote <code>ggplot2</code>, desenvolvido por <span class="citation" data-cites="wickham2016ggplot2">Wickham (<a href="referencias.html#ref-wickham2016ggplot2" role="doc-biblioref">2016</a>)</span> a partir da gramática de grafícos de <span class="citation" data-cites="wilkinson2012grammar">Wilkinson (<a href="referencias.html#ref-wilkinson2012grammar" role="doc-biblioref">2012</a>)</span>. A ideia por detrás dessa gramática, adotada pelo <code>ggplot2</code>, é a de que todo gráfico pode ser decomposto em camadas, cada uma delas representando um elemento do gráfico. Abordaremos este tema no capítulo, ainda que brevemente, para facilitar a compreensão da lógica de funcionamento do <code>ggplot2</code> – pacote que revolucionou o modo de produzir gráficos usando a linguagem R.</p>
<p>Para poder executar os códigos deste capítulo, você precisará carregar o <code>tidyverse</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="por-que-usar-visualizações" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="por-que-usar-visualizações"><span class="header-section-number">4.1</span> Por que usar visualizações?</h2>
<p>Dados podem ser apresentados em uma tabela, seja com valores brutos ou resumidos em alguma métrica, como veremos no próximo capítulo. No entanto, como argumentam <span class="citation" data-cites="kastellec2007using">Kastellec e Leoni (<a href="referencias.html#ref-kastellec2007using" role="doc-biblioref">2007</a>)</span>, em geral a análise gráfica é mais intuitiva. Compare, por exemplo, a tabela a seguir, que mostra um indicador fictício que varia ao longo dos anos, de 2010 a 2018, com a sua versão gráfica, ao lado:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output-display">
<table class="table table-condensed table-striped table-sm small" data-quarto-postprocess="true">
<caption>Indicador fictício ao longo do tempo </caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ano</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">indicador1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2010</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">2011</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2012</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="even">
<td style="text-align: right;">2013</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2014</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">27</td>
</tr>
<tr class="even">
<td style="text-align: right;">2017</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2018</td>
<td style="text-align: right;">29</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output-display">
<div id="fig-indicadores" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="04-cap_files/figure-html/fig-indicadores-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figura&nbsp;4.1: Gráfico de um indicador fictício</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Quando bem feito, um gráfico é capaz mostrar dados de forma <em>precisa</em>, <em>nítida</em> e <em>eficiente</em> suas informações <span class="citation" data-cites="healy2018data">(<a href="referencias.html#ref-healy2018data" role="doc-biblioref">Healy 2018</a>)</span>. Em outras palavras, ele passa a sua mensagem, ou a sua história, sem a necessidade ou o auxílio de um texto.</p>
<p>Para que tenhamos um visual gráfico claro, preciso e eficiente, vale levar em conta algumas observações de <span class="citation" data-cites="tufte1983visual">Tufte (<a href="referencias.html#ref-tufte1983visual" role="doc-biblioref">1983</a>)</span>. Para ele, bons gráficos colocam os dados acima de tudo, ou seja, todo e qualquer artifício de <em>design</em> só deve ser feito exclusivamente para ajudar deixar os dados mais nítidos, e não mais obtusos. A ideia de fundo é que devemos nos concentrar na substância dos dados, e não em qualquer outro elemento, como adereços desnecessários ou metodologia usada na produção de um gráfico. Sempre que possível, simplifique.</p>
<p>Outro ponto importante é que uma boa visualização deve conseguir levar aos olhos comparações de diferentes pedaços de dados disponibilizados – sem, contudo, gerar distorções destes mesmos dados, levando em consideração o propósito geral da análise, seja ela exploração ou descrição. Tudo isso considerado, usar visualizações é uma forma de comunicar resultados de forma global, com economia de espaço e, se bem feita, sem perda de precisão.</p>
</section>
<section id="fundamentos-do-ggplot2" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="fundamentos-do-ggplot2"><span class="header-section-number">4.2</span> Fundamentos do <code>ggplot2</code></h2>
<p>De longe o pacote mais utilizado para produzir visualizações em R, o <code>ggplot2</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> é baseado na gramática de gráficos, que é uma forma de descrever visualizações por meio de camadas. A ideia é que cada camada representa um elemento do gráfico: os dados usados para produzir formas e determinar escalas dos eixos, geometria, coordenadas, facetas e temas. Essa lógica separa, portanto, diferentes partes da produção de um gráfico, o que abre um universo de possibilidades de combinações entre essas camadas.</p>
<p>O que precisamos para fazer um gráfico no ggplot2? Basicamente, penas determinar quais são os nosso dados e a geometria que vamos usar. Para dar um exemplo inicial, usaremos dados de uma das mais tradicionais pesquisas de opinião do Brasil, o Estudo Eleitoral Brasileiro (ESEB), que é realizada periodicamente após eleições nacionais pelo <a href="https://www.cesop.unicamp.br/">Centro de Estudos de Opinião Pública (CESOP)</a>, da Universidade Estadual de Campinas (UNICAMP).<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> A base de dados que usaremos é a do ESEB 2022, disponível no formato SPSS no arquivo <code>eseb2022.sav</code> na pasta de materiais complementares deste livro. Para carregar o arquivo, podemos usar a função <code>read_sav</code> do pacote <code>haven</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregando pacotes</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregando dados</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>eseb <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"eseb2022.sav"</span>, <span class="at">encoding =</span> <span class="st">"latin1"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se inspecionarmos a base (com <code>View(eseb)</code>), veremos que os <em>labels</em> das variáveis não estão disponíveis. Isso acontece porque a função <code>read_sav</code> carrega apenas os códigos das categorias das variáveis, e não os <em>labels</em> que as descrevem, como vimos no <a href="02-cap.html"><span>Capítulo&nbsp;2</span></a>. Para usar os <em>labels</em>, podemos usar a função <code>as_factor</code>, também do pacote <code>haven</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>eseb <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(eseb)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com os dados carregados e com <em>labels</em> atribuídos, podemos fazer o seguinte gráfico usando o ggplot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Um grafico com ggplot</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>O código anterior cria um gráfico de barras indicando o número de pessoas entrevistadas pelo ESEB em diferentes faixas de idade. Apesar de simples e compacto, no entanto, há várias coisas que merecem ser destacadas nestas linhas. A primeira e mais importante delas: todo gráfico criado com o pacote <code>ggplot2</code> depende de execurtamos, logo no início, a função <code>ggplot</code> e, no mais das vezes, passarmos para ele nossos dados. Essa é a primeira camada de qualquer gráfico em <code>ggplot2</code> – se executarmos apenas esta linha, o R cria um painel em branco, sem qualquer informação, isto é, o fundo no qual todas as demais camadas serão adicionadas. Veja:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>No gráfico de barras feito anteriormente, passamos outro argumento para a função <code>ggplot</code> que é a estética (<em>aesthetic</em>), <code>aes(x = D01A_FX_ID)</code>. Esta é a parte da primeira camada do gráfico que mapeia as variáveis dos nossos dados para os atributos visuais do gráfico, gerando eixos, cores, formas e tamanhos. No nosso caso, mapeamos a variável <code>D01A_FX_ID</code> para o eixo X, ou eixo horizontal. Em termos práticos, passar a estética <code>aes(x = D01A_FX_ID)</code> produz o seguinte resultado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Nosso gráfico, agora, não é apenas uma tela em branco – <code>aes()</code> passou a informação de que queremos usar a variável <code>D01A_FX_ID</code> para o eixo X e, automaticamente, o <code>ggplot2</code> adicionou um eixo X com escalas e rótulos. Com esse código, portanto, criamos a primeira camada da nossa visualização Finalmente, a segunda camada que usamos no exemplo inicial foi uma geometria, introduzida por meio da função <code>+ geom_bar()</code>. Como o nome sugere, esta serve para criar barras, fazendo a contagem de quantas pessoas entrevistadas temos em cada faixa de idade na base do ESEB.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Combinação de camadas
</div>
</div>
<div class="callout-body-container callout-body">
<p>Para criar um gráfico no <code>ggplot2</code>, conectando camadas por meio do operador <code>+</code> (não confundir com o <em>pipe</em>, <code>|&gt;</code>.).</p>
</div>
</div>
<p>E se quisermos fazer um gráfico de pontos (<em>scatterplot</em>) em de um gráfico de barras? E se quisermos mudar as escalas dos eixos do nosso gráfico? É possível mudar cores, tamanhos e formas? A resposta para todas essas perguntas é sim, e a lógica para fazer isso é sempre a mesma: adicionamos camadas ao gráfico, combinando-as com o operador <code>+</code>, como veremos na sequência.</p>
</section>
<section id="camadas-de-uma-visualização" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="camadas-de-uma-visualização"><span class="header-section-number">4.3</span> Camadas de uma visualização</h2>
<p>Podemos melhorar muito a capacidade informativa do nosso gráfico. Para isso, podemos explorar mais os elementos que consitituem a lógica da criação de gráficos em R com <code>ggplot</code> – ou, melhor, a gramática de gráficos <span class="citation" data-cites="wilkinson2012grammar">(<a href="referencias.html#ref-wilkinson2012grammar" role="doc-biblioref">Wilkinson 2012</a>)</span>. Já usamos os dois primeiros elementos desta lógica:</p>
<ol type="1">
<li><strong>Dados:</strong> conjutos de informações que queremos visualizar e variáveis que serão mapeadas em atributos estéticos;</li>
<li><strong>Geometria:</strong> camadas que contém elementos geoméricos e transformações estatísticas; no ggplot e extensões, essas funções começam com o prefixo <code>geom_</code>;</li>
<li><strong>Escalas:</strong> valores em um espaço, incluindo cor, tamanhos ou formas de atributos do gráfico, além de eixos e legendas; funções começam com o prefixo <code>scale_</code>;</li>
<li><strong>Coordenadas:</strong> o sistema de coordenadas utilizada, por padrão a coordenada cartesiana, indicando um X e um Y (eixo vertical); estão disponíveis também outros sistemas de coordenadas, como a polar e projeção de mapas; funções têm o prefixo <code>coord_</code>;</li>
<li><strong>Faceta:</strong> para fazer gráficos em subgrupos do mesmo conjunto de dados; funções usam o prefixo <code>facet_</code>;</li>
<li><strong>Temas</strong>: controle de vários recursos de exibição, como tamanho da fonte e cor do plano de fundo, rotação de texto nos eixos, grade, entre outros; há uma função genérica chama <code>theme</code>, que permite a customização de diferentes detalhes de um gráfico, e outras funções usam o prefixo <code>theme_</code>.</li>
</ol>
<p>Dito isto, vamos editar nosso gráfico.</p>
<section id="geometrias" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="geometrias"><span class="header-section-number">4.3.1</span> Geometrias</h3>
<p>Vamos começar com camadas de geometria. No exemplo anterior, usamos a função <code>geom_bar()</code> para criar um gráfico de barras. No entanto, o <code>ggplot2</code> tem várias outras geometrias que podem ser usadas para criar diferentes tipos de gráficos. Na base do ESEB, temos uma variável <code>D01A_IDADE</code> que indica a idade das pessoas entrevistas, em números inteiros. Podemos usar essa variável para criar, por exemplo, um histograma, que nada mais é do que um gráfico de barras que mostra a distribuição de uma variável numérica. Para isso, usamos a função <code>geom_histogram()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_IDADE)) <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Como podemos ver, o gráfico anterior mostra o número de pessoas com determinada idade. Outra forma de visualizar a mesma informação é usando um gráfico de densidade, que mostra a distribuição de uma variável numérica de forma suave. Para isso, usamos a função <code>geom_density()</code>:<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_IDADE)) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Cada função <code>geom_</code>, portanto, cria um tipo diferente de gráfico. No entanto, é importante lembrar que cada uma delas tem suas próprias particularidades – <code>geom_density</code> e <code>geom_histogram</code>, por exemplo, não servem para fazer gráficos de variáveis categóricas, enquanto que <code>geom_bar</code> não serve para fazer gráficos de variáveis numéricas. A tabela abaixo apresenta um resumo das principais funções <code>geom_</code>, quais tipos de variáveis demandam e o tipo de gráfico que produzem:</p>
<div id="tbl-geoms" class="anchored">
<table class="table-sm table-hover table-striped small table">
<caption>Tabela&nbsp;4.1: Funções <code>geom_</code> mais comuns</caption>
<thead>
<tr class="header">
<th>Função</th>
<th>Variáveis necessárias</th>
<th>Visualização</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>geom_bar()</code></td>
<td><code>x</code> categórica</td>
<td>Gráfico de barras</td>
</tr>
<tr class="even">
<td><code>geom_col()</code></td>
<td><code>x</code> categórica e <code>y</code> numérica</td>
<td>Gráfico de barras</td>
</tr>
<tr class="odd">
<td><code>geom_histogram()</code></td>
<td><code>x</code> numérica</td>
<td>Histograma</td>
</tr>
<tr class="even">
<td><code>geom_density()</code></td>
<td><code>x</code> numérica</td>
<td>Gráfico de densidade</td>
</tr>
<tr class="odd">
<td><code>geom_line()</code></td>
<td><code>x</code> e <code>y</code> numéricas</td>
<td>Gráfico de linhas</td>
</tr>
<tr class="even">
<td><code>geom_point()</code></td>
<td><code>x</code> e <code>y</code> numéricas</td>
<td>Gráfico de pontos</td>
</tr>
<tr class="odd">
<td><code>geom_boxplot()</code></td>
<td><code>x</code> categórica e <code>y</code> numérica</td>
<td>Boxplot</td>
</tr>
<tr class="even">
<td><code>geom_violin()</code></td>
<td><code>x</code> categórica e <code>y</code> numérica</td>
<td>Violin plot</td>
</tr>
</tbody>
</table>
</div>
<p>Apesar de diferentes, geometrias como <code>geom_bar</code> e <code>geom_density</code> precisam apenas de uma variável para criar visualizações, outras como <code>geom_boxplot</code> e <code>geom_violin</code> precisam de duas variáveis, uma categórica, que informará o eixo X, e, a outra, numérica. Para exemplificar ambas, podemos fazer um gráfico que mostra a distribuição da idade das pessoas entrevistadas pelo ESEB por sexo (variável <code>D02</code>), usando um boxplot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D02, <span class="at">y =</span> D01A_IDADE)) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>E um gráfico que mostra a distribuição da idade das pessoas entrevistadas pelo ESEB por sexo (variável <code>D02</code>), usando gráfico de violino – um tipo de gráfico que combina boxplot e gráfico de densidade:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D02, <span class="at">y =</span> D01A_IDADE)) <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para outros tipos de gráficos, por sua vez, às vezes é necessário ter duas variáveis numéricas, como no caso de gráficos de pontos. Para exemplificar essa geometria, vamos carregar novamente a base sobre capitais do país, que vimos no <a href="03-cap.html"><span>Capítulo&nbsp;3</span></a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"capitais.Rda"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com ela, podemos fazer, por exemplo, um gráfico de pontos que mostra a relação entre despesas em educação e despesas em saúde desses municípios usando <code>geom_point</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(capitais, <span class="fu">aes</span>(<span class="at">x =</span> despesa_educacao, <span class="at">y =</span> despesa_saude)) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>O conteúdo do gráfico, obviamente, não nos diz muito, mas o código exemplifica o ponto subjacente: para fazer um gráfico de pontos, precisamos de duas variáveis numéricas, uma para o eixo X e, a outra, para o eixo Y.</p>
<section id="customizando-geometrias" class="level4" data-number="4.3.1.1">
<h4 data-number="4.3.1.1" class="anchored" data-anchor-id="customizando-geometrias"><span class="header-section-number">4.3.1.1</span> Customizando geometrias</h4>
<p>Além de criar diferentes tipos de gráficos, as funções <code>geom_</code> também permitem customizações por meio dos seus diferentes argumentos. Em um gráfico de barras criado com <code>geom_bar</code>, por exemplo, podemos mudar a cor e a largura das barras; a cor e o tamanho dos contornos das barras; etc. No exemplo a seguir, usamos a função <code>geom_bar</code> para criar um gráfico de barras que mostra o número de pessoas entrevistadas pelo ESEB em diferentes faixas de idade, mas com barras em laranja e mais finas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">width =</span> <span class="fl">0.5</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Tudo o que fizemos no código anterior foi declarar dois argumentos dentro da função <code>geom_bar</code>: <code>fill</code>, que muda a cor das barras, e <code>width</code>, que muda a largura das barras. Quanto à primeira modificação, quando mudamos cores podemos recorrer a nomes de cores em inglês (como <em>gray</em>, <em>blue</em>, <em>darkblue</em>), ou códigos hexadecimais, também chamados de cores <em>hex</em><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, como <code>#FFA500</code> para laranja. Quanto à segunda modificação, a largura das barras é dada em proporção ao espaço disponível no eixo X, que vai de 0 a 1 – número mais próximos de 1 criam barras mais largas.</p>
<p>Cada <code>geom_</code> têm seus próprios argumentos, e a melhor forma de saber quais são eles é consultando a documentação do <code>ggplot2</code> ou usando a função <code>?</code> seguida do nome da função. Via de regra, entretanto, vale lembrar que a maioria das funções <code>geom_</code> têm argumentos que controlam cor, tamanho e forma dos elementos que criam. Para referência, reportamos em seguida alguns dos argumentos mais comuns dessas <code>geom_</code>, o que fazem e valores de referência:</p>
<div id="tbl-args" class="anchored">
<table class="table-sm table-hover table-striped small table">
<caption>Tabela&nbsp;4.2: Argumentos comuns em funções <code>geom_</code></caption>
<colgroup>
<col style="width: 13%">
<col style="width: 31%">
<col style="width: 27%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>Geometria</th>
<th>Argumento</th>
<th>Descrição</th>
<th>Valores</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>geom_bar()</code>, <code>geom_col()</code>, <code>geom_histogram()</code>, <code>geom_density()</code>, entre outras</td>
<td><code>fill</code></td>
<td>Muda a cor de preenchimento de barras e áreas</td>
<td>Nome de cor ou código <em>hex</em> (e.g., “orange”)</td>
</tr>
<tr class="even">
<td><code>geom_bar()</code>, <code>geom_col()</code>, <code>geom_histogram()</code>, <code>geom_density()</code>, entre outras</td>
<td><code>color</code></td>
<td>Muda a cor do contorno de barras e áreas</td>
<td>Nome de cor ou código <em>hex</em> (e.g., “orange”)</td>
</tr>
<tr class="odd">
<td><code>geom_bar()</code>, <code>geom_col()</code>, <code>geom_histogram()</code>, <code>geom_density()</code>, entre outras</td>
<td><code>alpha</code></td>
<td>Muda a transparência de barras e áreas</td>
<td>Número entre 0 e 1</td>
</tr>
<tr class="even">
<td><code>geom_bar()</code>, <code>geom_col()</code>, <code>geom_histogram()</code>, <code>geom_density()</code>, entre outras</td>
<td><code>width</code></td>
<td>Muda a largura de barras e áreas</td>
<td>Número entre 0 e 1</td>
</tr>
<tr class="odd">
<td><code>geom_line()</code>, <code>geom_path()</code>, entre outras</td>
<td><code>color</code></td>
<td>Muda a cor de linhas</td>
<td>Nome de cor ou código <em>hex</em> (e.g., “orange”)</td>
</tr>
<tr class="even">
<td><code>geom_line()</code>, <code>geom_path()</code>, entre outras</td>
<td><code>linewidth</code></td>
<td>Muda a espessura de linhas</td>
<td>Número</td>
</tr>
<tr class="odd">
<td><code>geom_point()</code>, <code>geom_jitter()</code>, entre outras</td>
<td><code>color</code></td>
<td>Muda a cor de pontos</td>
<td>Nome de cor ou código <em>hex</em> (e.g., “orange”)</td>
</tr>
<tr class="even">
<td><code>geom_point()</code>, <code>geom_jitter()</code>, entre outras</td>
<td><code>size</code></td>
<td>Muda o tamanho de pontos</td>
<td>Número</td>
</tr>
<tr class="odd">
<td><code>geom_point()</code>, <code>geom_jitter()</code>, entre outras</td>
<td><code>shape</code></td>
<td>Muda a forma de pontos</td>
<td>Número entre 0 e 25</td>
</tr>
</tbody>
</table>
</div>
<p>Ainda neste capítulo, veremos mais exemplos de aplicação destes argumentos.</p>
</section>
</section>
<section id="escalas" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="escalas"><span class="header-section-number">4.3.2</span> Escalas</h3>
<p>A próxima camada que vamos explorar são as escalas. No exemplo do gráfico de barras que fizemos anteriormente, por exemplo, usamos a função <code>geom_bar</code> para criar um gráfico de barras que mostra o número de pessoas entrevistadas pelo ESEB em diferentes faixas de idade. No entanto, o eixo X do gráfico mostra categorias fechadas. Se quisermos alterar isso, podemos usar a função <code>scale_x_discrete</code> (ou <code>scale_y_discrete</code>) para mapear os códigos das faixas de idade para as faixas de idade em si:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"16 e 17 anos"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"18 a 24 anos"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"25 a 34 Anos"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"35 a 44 Anos"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"45 a 54 Anos"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"55 a 64 anos"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"65 e mais"</span> <span class="ot">=</span> <span class="st">"65+"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Com <code>scale_</code>, passamos o argumento <code>labels =</code> que mapeia os códigos das faixas de idade para outros textos quaisquer. O resultado é um gráfico de barras que mostra o número de pessoas entrevistadas pelo ESEB em diferentes faixas de idade, mas com rótulos mais concisos.</p>
<p>A função correspondente para eixos numéricos, isto é, <code>scale_x_continuous</code> (ou <code>scale_y_discrete</code>, se for para o eixo Y), também permite mudar a escala do eixo Y de um gráfico. Um dos seus usos mais comuns é o de alterar os valores máximos e mínimos a serem exibidos no eixo desejado. Um exemplo alterando o valor máximo do eixo Y para 1000:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"16 e 17 anos"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"18 a 24 anos"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"25 a 34 Anos"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"35 a 44 Anos"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"45 a 54 Anos"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"55 a 64 anos"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"65 e mais"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para alterar nomes dos eixos, títulos e subtítulos, podemos usar a função <code>labs()</code> em mais uma camada:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"16 e 17 anos"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"18 a 24 anos"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"25 a 34 Anos"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"35 a 44 Anos"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"45 a 54 Anos"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"55 a 64 anos"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"65 e mais"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span>  </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entrevistados por faixa de idade"</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"ESEB 2022"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"N"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A função, como dá para notar pelo código anterior, tem argumentos que permitem mudar o título do gráfico, o subtítulo e os rótulos dos eixos X e Y, além de outros como <code>caption</code>, para adicionar nota de pé de gráfico.</p>
</section>
<section id="coordenadas" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="coordenadas"><span class="header-section-number">4.3.3</span> Coordenadas</h3>
<p>Vamos agora fazer um novo gráfico com a mesma geometria, a barra, dessa vez com dados sobre o tamanho da população do Brasil por Unidade da Feração, conforme apurado pelo Censo de 2022. O arquivo com esses dados está na pasta de materiais complementares deste livro com o nome de <code>POP2022_Brasil.csv</code>. Podemos carregá-lo assim:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pop_uf <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"POP2022_Brasil.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isto feito, podemos fazer um gráfico de barras que mostra a população de cada Unidade da Federação do Brasil com uma camada nova, <code>coord_flip()</code>, que inverte os eixos X e Y do gráfico:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pop_uf, <span class="fu">aes</span>(<span class="at">x =</span> Unidades_Federacao, <span class="at">y=</span>  POPULACAO)) <span class="sc">+</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"População por UF"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Censo 2022 (IBGE)"</span>, <span class="at">y =</span> <span class="st">"N"</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Repetimos basicamente o mesmo código do gráfico com os dados do ESEB. As principais alterações foram: 1) na definição da estética, com <code>aes()</code>, incluímos um eixo Y indicando o tamanho de cada barra representando as categorias do eixo X, e 2) na geometria, usamos<code>geom_col</code> justamente porque passamos os valores de tamanho das barras em <code>y</code>. A maior diferença, no entanto, é a adição da camada <code>coord_flip()</code>, que inverte os eixos X e Y do gráfico, o que produz uma visualização na qual as barras aparecem deitadas, isto é, na horizontal.</p>
<p>Embora o <code>ggplot2</code> tenha outras funções <code>coord_</code>, <code>cood_flip</code> é, de longe, a mais comum. No entanto, há outras funções <code>coord_</code> que podem ser úteis em diferentes situações. A função <code>coord_polar</code>, por exemplo, é usada para criar gráficos circulares, enquanto <code>coord_map</code> é usada às vezes para criar mapas, ajustando coordenadas para representar adequadamente a superfície da Terra.</p>
</section>
<section id="facetas" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="facetas"><span class="header-section-number">4.3.4</span> Facetas</h3>
<p>Imagine o seguinte problema: temos os dados de faixa etária da população do país em um gráfico de barras, mas queremos ver essa distribuição para cada uma das cinco regiões do país. Como fazer isso sem precisar criar cinco gráficos individualmente? Esse é o problema que as facetas resolvem. Especificamente, estas permitem que façamos gráficos em subgrupos do mesmo conjunto de dados indicando apenas qual variável deve ser usada para dividir os gráficos. No exemplo a seguir, usaremos uma dessas funções, <code>facet_wrap</code>, para refazer o nosso gráfico de barras com dados do ESEB, dessa vez quebrando ele por região do país (a variável que indica as regiões no banco <code>eseb</code> é <code>REG</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"16 e 17 anos"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"18 a 24 anos"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"25 a 34 Anos"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"35 a 44 Anos"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"45 a 54 Anos"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"55 a 64 anos"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"65 e mais"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span>  </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> REG) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entrevistados por faixa de idade"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"ESEB 2022"</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"N"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note que apenas uma linha de código foi adicionada ao gráfico anterior, <code>facet_wrap(~ REG)</code>, mas o resultado, agora, são cinco painéis, um para cada região do país. O detalhe de termos de usar um til, <code>~ REG</code>, pode ser lido como um indicativo de que queremos fazer um gráfico para cada nível da variável <code>REG</code> (é possível combinar variáveis usando <code>+</code>, embora seja um uso raro de facetas). Outro detalhe é que, por padrão, <code>facet_wrap</code> usa a mesma escala dos eixos X e Y para todos os painéis, mas é possível mudar isso com o argumento <code>scales</code>, que podem assumir os valores de “fixed”, “free”, “free_x” e “free_y”. Para deixar o eixo Y de cada painel variar livremente, por exemplo, podemos fazer o seguinte:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"16 e 17 anos"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"18 a 24 anos"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"25 a 34 Anos"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"35 a 44 Anos"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"45 a 54 Anos"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"55 a 64 anos"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"65 e mais"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> REG, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entrevistados por faixa de idade"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB 2022"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Por fim, outro argumento útil da função <code>facet_wrap</code> é <code>ncol</code>, que permite especificar o número de colunas que os painéis devem ter. No exemplo a seguir, usamos <code>ncol = 2</code> para fazer um gráfico com duas colunas de painéis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"16 e 17 anos"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"18 a 24 anos"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"25 a 34 Anos"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"35 a 44 Anos"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"45 a 54 Anos"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"55 a 64 anos"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"65 e mais"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span>  </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> REG, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entrevistados por faixa de idade"</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB 2022"</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Facetas não é algo exclusivo de <code>facet_wrap</code>. Há outras funções <code>facet_</code> que podem ser usadas para fazer gráficos em subgrupos do mesmo conjunto de dados: <code>facet_grid</code>, por exemplo, é usada para fazer gráficos em subgrupos de duas variáveis, uma para o eixo X e outra para o eixo Y. A função <code>facet_grid</code> é especialmente útil para fazer gráficos em subgrupos de duas variáveis categóricas, como no exemplo a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"16 e 17 anos"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"18 a 24 anos"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"25 a 34 Anos"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"35 a 44 Anos"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"45 a 54 Anos"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"55 a 64 anos"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"65 e mais"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span>  <span class="fu">facet_grid</span>(REG <span class="sc">~</span> D02) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entrevistados por faixa de idade"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB 2022"</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="temas" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5" class="anchored" data-anchor-id="temas"><span class="header-section-number">4.3.5</span> Temas</h3>
<p>A última camada que abordaremos é, em geral, também a mais especial no <code>ggplot2</code>, aquela que torna o pacote especialmente popular entre cientistas de dados: a camada de temas.</p>
<p>Resumidamente, temas são funções que controlam vários recursos de exibição de uma visualização, como tamanho da fonte e cor do plano de fundo, rotação e cor de textos, grades e linhas de eixos, entre inúmeras outras coisas. Para fazer essas modificações, o <code>ggplot2</code> tem uma função genérica chama <code>theme()</code> que permite a customização de diferentes detalhes de um gráfico, além de outras funções que usam o prefixo <code>theme_</code> e aplicam customizações globais pré-estabelecidas em um gráficos. Começando por estas últimas funções, vamos usar a função <code>theme_minimal()</code> para criar um gráfico de barras com um tema minimalista (e, portanto, menos distrativo):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eseb, <span class="fu">aes</span>(<span class="at">x =</span> D01A_FX_ID)) <span class="sc">+</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"16 e 17 anos"</span> <span class="ot">=</span> <span class="st">"16-17"</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"18 a 24 anos"</span> <span class="ot">=</span> <span class="st">"18-24"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"25 a 34 Anos"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"35 a 44 Anos"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"45 a 54 Anos"</span> <span class="ot">=</span> <span class="st">"45-54"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"55 a 64 anos"</span> <span class="ot">=</span> <span class="st">"55-64"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"65 e mais"</span> <span class="ot">=</span> <span class="st">"65+"</span>)) <span class="sc">+</span>  <span class="fu">facet_grid</span>(REG <span class="sc">~</span> D02) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entrevistados por faixa de idade"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB 2022"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-cap_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Além desta, o <code>ggplot2</code> também tem outras funções <code>theme_</code> comuns: <code>theme_bw</code>, por exemplo, cria um gráfico com um tema em preto e branco, enquanto <code>theme_classic</code> cria um gráfico com um tema clássico. A função <code>theme_void</code>, por sua vez, cria um gráfico sem nenhum tema, isto é, sem grade, sem fundo, sem nada, o que pode ser útil em mapas, como veremos adiante.</p>
<p>Suponha agora que, em seu projeto de visualização de dados, as informações do eixo Y sejam desnecessárias. Podemos usar nossa função genérica <code>theme</code> para fazer essa edição. Como ja estamos usando um tema, a camada com a função genérica vai logo após o tema em uso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(<span class="fu">as.character</span>(D01A_FX_ID))) <span class="sc">+</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Número de entrevistados por faixa de idade"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB - 2022"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>O código anterior é menos intuitivo e, por isso mesmo, merece maior atenção. A função <code>theme</code> é usada para fazer customizações em um gráfico, e a função <code>element_blank()</code> é usada para remover elementos de um gráfico. No caso, determinamos que os argumentos da função <code>theme</code> <code>axis.line.y</code>, <code>axis.text.y</code> e <code>axis.ticks.y</code> (que são usados para customizar a linha, o texto, os traços e o título do eixo Y, respectivamente), deverão ser removidos do gráfico. Mas e se, em vez de remove a linha do eixo Y do gráfico, quisermos mudar a cor dela? Podemos fazer isso com a função <code>element_line</code>, que é usada para customizar linhas de um gráfico:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(<span class="fu">as.character</span>(D01A_FX_ID))) <span class="sc">+</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Número de entrevistados por faixa de idade"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ESEB 2022"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Faixa de Idade"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"red"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>De forma geral, para cada mínimo componente imaginável de uma tema em <code>ggplot2</code> há um argumento da função <code>theme</code> que pode ser usado para customizá-lo. A melhor forma de saber quais são esses argumentos é consultando a documentação do <code>ggplot2</code> ou usando a função <code>?</code> seguida do nome da função que você deseja usar. Assim como geometrias e outros, no entanto, vale lembrar que a maioria das funções <code>theme_</code> têm argumentos que controlam cor, tamanho e forma dos elementos que criam. Avançar neste tópico é uma forma de aprimorar a estética de suas visualizações, mas também de torná-las mais eficientes e legíveis.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Extensões
</div>
</div>
<div class="callout-body-container callout-body">
<p>Além das geometria nativas do <code>ggplot2</code>, é possível criar suas próprias extensões ou instalar a que outras pessoas criaram. O <code>tidyverse</code> organiza e disponiliza uma coleção bastatante rica dessas extenções: <a href="https://exts.ggplot2.tidyverse.org/gallery/">https://exts.ggplot2.tidyverse.org/gallery/</a>.</p>
</div>
</div>
</section>
</section>
<section id="resumo" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="resumo"><span class="header-section-number">4.4</span> Resumo</h2>
<p>Neste capítulo, estudamos os principais conceitos para produção de gráficos no R usando o pacote ggplot. Utilizamos alguns dados de exemplo para compreender o funcionamento do pacote <code>ggplot</code> e o processo de adição de camadas para criar nossos projetos gráficos. Embora não tenhamos explorado todas as possibilidades aqui, abrimos os principais caminhos seguidos para produzirmos visualizações simples e eficientes.</p>
</section>
<section id="exercícios" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercícios">Exercícios</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Arquivos necessários
</div>
</div>
<div class="callout-body-container callout-body">
<p>Para realizar estes exercícios, será necessário baixar os arquivos que estão na pasta de materiais complementares deste livro e salvá-los na pasta de trabalho do R.</p>
</div>
</div>
<section id="gráficos-de-barras" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="gráficos-de-barras">1. Gráficos de barras</h4>
<p>A base de dados do ESEB de 2022, disponível no arquivo <code>eseb2022.sav</code>, tem uma variavel chamada de <code>Q10P2b</code> que indica o voto das pessoas entrevistadas para Presidente no segundo turno das eleições de 2022 disputada entre Lula e Bolsonaro. Usando essa variável, crie um gráfico de barras que o total de votos de cada candidato na amostra do Eseb.</p>
</section>
<section id="gráficos-de-barras-com-facetas" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="gráficos-de-barras-com-facetas">2. Gráficos de barras com facetas</h4>
<p>Usando a mesma variável <code>Q10P2b</code> e a variável <code>REG</code>, que indica região, da base do Eseb, crie agora um gráfico de barras que mostra o total de votos de cada candidato na amostra do Eseb, mas com painéis para cada região do país. Use duas colunas para organizar os painéis.</p>
</section>
<section id="gráficos-de-histograma" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="gráficos-de-histograma">3. Gráficos de histograma</h4>
<p>Para este exercício, carregue novamente dados do Censo de 1872, que carregamos no <a href="02-cap.html"><span>Capítulo&nbsp;2</span></a>, disponíveis no seguinte link:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/izabelflores/Censo_1872/main/Censo_1872_dados_tidy_versao2.csv">https://raw.githubusercontent.com/izabelflores/Censo_1872/main/Censo_1872_dados_tidy_versao2.csv</a></li>
</ul>
<p>Com os dados carregados, crie um gráfico que mostre a distribuição das pessoas consideradas de raça preta, segundo a denominação do Censo, indicada pela variável <code>Raças_Preto</code>.</p>
</section>
<section id="gráficos-de-barras-com-totais-calculados" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="gráficos-de-barras-com-totais-calculados">4. Gráficos de barras com totais calculados</h4>
<p>Usando a mesma base do Censo de 1872, use funções de manipulação de dados para calcular o total de pessoas (variável <code>Total_Almas</code>) por província no Brasil da época (a variável <code>PrimeiroDeProvincia</code> indica as províncias). Com esses totais calculados, crie um gráfico de barras que mostra o total de pessoas por província (dica: este gráfico deve indicar em <code>aes</code> um eixo X e um eixo Y).</p>
</section>
<section id="temas-e-customizações" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="temas-e-customizações">5. Temas e customizações</h4>
<p>Com o mesmo gráfico do exercício anterior, aplique um tema de sua escolha e faça customizações no gráfico, como mudar cores, tamanhos e formas de elementos, e remover ou adicionar elementos do gráfico. Use comentários para explicar as modificações realizadas.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-healy2018data" class="csl-entry" role="listitem">
Healy, Kieran. 2018. <em>Data visualization: a practical introduction</em>. Princeton University Press.
</div>
<div id="ref-kastellec2007using" class="csl-entry" role="listitem">
Kastellec, Jonathan P, e Eduardo L Leoni. 2007. <span>«Using graphs instead of tables in political science»</span>. <em>Perspectives on politics</em> 5 (4): 755–71.
</div>
<div id="ref-tufte1983visual" class="csl-entry" role="listitem">
Tufte, Edward R. 1983. <span>«The visual display of»</span>. <em>Quantitative Information</em>, 13.
</div>
<div id="ref-wickham2016ggplot2" class="csl-entry" role="listitem">
Wickham, Hadley. 2016. <em>ggplot2: Elegant Graphics for Data Analysis</em>. Springer.
</div>
<div id="ref-wilkinson2012grammar" class="csl-entry" role="listitem">
Wilkinson, Leland. 2012. <em>The grammar of graphics</em>. Springer.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Normalmente mencionamos <code>ggplot</code> quando estamos falando do pacote <code>ggplot2</code>, utilizado para produzir gráficos.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>O ESEB é conduzido desde 2002 e é vinculado ao <em>Comparative Study of Electoral Systems Project (CSES)</em>, projeto global de pesquisas pós-eleitorais. Para saber mais sobre o ESEB, ver <a href="https://www.cesop.unicamp.br/por/eseb">https://www.cesop.unicamp.br/por/eseb</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Densidade aqui se refere a uma função de densidade de probabilidade, que é uma função que descreve a probabilidade de uma variável aleatória cair em um intervalo particular de valores.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Cores podem ser representadas por códigos de seis dígitos que representam a intensidade de vermelho, verde e azul (RGB) de uma cor. Por exemplo, o código hexadecimal para a cor laranja é <code>#FFA500</code> e, para vermelho, <code>#FF0000</code>. Há diversos <em>websites</em> dedicados para consultar códigos <em>hex</em> de cores específicas, como o <a href="https://www.color-hex.com/">color-hex.com</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03-cap.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Manipulação</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05-cap.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Análise</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Usando R, por Fernando Meireles e Denisson Silva</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>